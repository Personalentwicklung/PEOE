<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baukasten für Copilot-Chat-Agenten</title>
  <style>
    :root{
      /* Farben – angelehnt an PEOE-Seiten */
      --primary:#005A9C;
      --primary-600:#0a66a8;
      --accent:#2FB1C5; 
      --bg:#f5f7fa;
      --card-bg:#ffffff;
      --subtle:#eef2f5;
      --muted:#4a5568;
      --text:#1a202c;
      --border:#e2e8f0;
      --shadow:0 4px 14px rgba(0,0,0,0.08);
      --radius:10px;
      --warning:#C05621;
      --success:#2F855A;
      --focus:#2FB1C5;
      /* Hellgrün für editierbare Felder */
      --edit-bg:#E8F5E9;
      --edit-border:#81C784;
      --edit-focus:#43A047;
      /* Grau für nicht-editierbare Badge (Rolle) */
      --badge-bg:#E5E7EB;
      --badge-border:#D1D5DB;
      /* Maße */
      --container:1024px;
      --space-1:8px;
      --space-2:12px;
      --space-3:16px;
      --space-4:20px;
      --space-5:28px;
      --space-6:36px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .container{max-width:var(--container);margin:0 auto;padding:24px;}
    h1{font-size:28px;margin:0 0 var(--space-4);color:var(--primary);text-align:center}
    h2{font-size:22px;margin:0 0 var(--space-3);color:var(--primary)}
    h3{font-size:18px;margin:0 0 var(--space-2);color:var(--primary)}
    p{margin:0 0 var(--space-3);color:var(--text)}
    .card{
      background:var(--card-bg);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--space-5);
      margin:0 0 var(--space-5);
    }
    .subcard{
      background:var(--subtle);
      border:1px solid var(--border);
      border-radius:8px;
      padding:16px;
      margin:var(--space-3) 0;
    }
    .btn{
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:12px 20px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    .btn:hover{background:var(--primary-600)}
    .btn:focus{outline:3px solid var(--focus);outline-offset:2px}
    .btn--sm{padding:8px 14px;font-size:14px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:20px;flex-wrap:wrap;align-items:flex-start}
    .grow{flex:1 1 320px}
    /* Sub-Hinweise: Frage fett, Auswahlhinweis normal */
    .subhint{font-size:14px;color:var(--muted);margin:0 0 6px;}
    .subhint--question{font-weight:600;color:var(--text);} /* fett wie Label */
    .subhint--choose{font-weight:400;} /* nicht fett */
    /* Selects */
    select{
      width:100%;
      min-width:280px;
      max-width:100%;
      padding:6px;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff;
      color:var(--text);
      font-size:14px;
      line-height:1.4;
    }
    select option{font-size:14px;}
    .meta{
      display:flex;align-items:center;gap:12px;
      margin-top:8px;color:var(--muted);font-size:14px;
    }
    .hint{color:var(--warning);font-size:14px;margin-top:6px}
    .preview{
      margin-top:12px;
      padding:10px 12px;
      border:1px dashed var(--border);
      border-radius:8px;
      background:#fcfcfd;
    }
    .editable{
      display:inline-block;
      min-width:160px;
      min-height:1.4em;
      background:var(--edit-bg);
      border:1px dashed var(--edit-border);
      border-radius:6px;
      padding:2px 6px;
      line-height:1.6;
    }

.demo-editable {
  display:inline-block;
  background:var(--edit-bg);
  border:1px dashed var(--edit-border);
  border-radius:6px;
  padding:2px 6px;
  line-height:1.6;
  font-size:14px;
  cursor:default;
  user-select:none;
}

    .editable:focus{outline:2px solid var(--edit-focus);background:#E3F2E5}
    .badge-gray{
      display:inline-block;
      min-width:160px;
      min-height:1.4em;
      background:var(--badge-bg);
      border:1px solid var(--badge-border);
      border-radius:6px;
      padding:2px 6px;
      line-height:1.6;
    }
    .copy-area .title-line{font-weight:700;margin-bottom:8px}
    .copy-msg{margin-top:10px;color:var(--success);display:none}
    /* Startscreen / Umschaltung */
    #builder{display:none}
    .centered{display:flex;min-height:100vh;align-items:center;justify-content:center}
    .start-card{max-width:760px}
    /* Hinweisbox */
    .top-note{
      margin-bottom:var(--space-4);
      padding:12px 14px;
      border-left:4px solid var(--accent);
      background:#f3fafc;
      border-radius:6px;
    }
    .actions-line{
      display:flex;justify-content:flex-end;gap:10px;margin-top:14px;flex-wrap:wrap;
    }
    .info-btn{
      background:#ffffff;color:var(--primary);border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-weight:600;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.06);
    }
    .info-btn:hover{background:#f7fafc}
    .info-btn:focus{outline:3px solid var(--focus);outline-offset:2px}
    .info-panel{
      margin-top:12px;padding:12px 14px;border:1px solid var(--border);border-radius:8px;background:#fff;box-shadow:var(--shadow);display:none;
    }
    .info-panel h4{margin:0 0 8px;font-size:16px;color:var(--primary);}
    .info-panel p{margin:0 0 10px;color:var(--text)}
    .info-panel .close-info{
      background:transparent;color:var(--muted);border:1px solid var(--border);border-radius:999px;padding:6px 10px;cursor:pointer;
    }
    .info-panel .close-info:hover{background:#f8fafc}
    @media (max-width: 720px){.container{padding:16px;}h1{font-size:24px}}
  /* === Info-Modal (Optionale Info-Ebene) === */
    @keyframes soft-pulse {
      0% { box-shadow: 0 0 0 0 rgba(47, 177, 197, 0.40); }
      70% { box-shadow: 0 0 0 10px rgba(47, 177, 197, 0.00); }
      100% { box-shadow: 0 0 0 0 rgba(47, 177, 197, 0.00); }
    }
    .info-pulse { animation: soft-pulse 3s infinite; }
    #infoModal {
      display: none; position: fixed; inset: 0; z-index: 10000;
      background: rgba(0,0,0,0.65); backdrop-filter: blur(4px);
      align-items: center; justify-content: center; padding: 24px;
    }
    .modal-content {
      background: var(--card-bg); padding: 40px; border-radius: var(--radius);
      max-width: 700px; width: 100%; position: relative; box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .close-x { position: absolute; top: 10px; right: 14px; font-size: 32px; cursor: pointer; color: var(--muted); line-height: 1; }
    .info-step { display: none; text-align: left; }
    .info-step.active { display: block; }
    .info-step ul { margin: 0; padding-left: 18px; }
    .step-nav { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-top: 24px; border-top: 1px solid var(--border); padding-top: 16px; }
    /* === End Info-Modal === */


/* Subcard im Preset-Kasten normalisieren */

#sub-presets {
  background: var(--subtle);   /* exakt wie alle anderen Inlay-Boxen */
  border: 1px solid var(--border);
}


/* === Copy-Button: schneller Puls ================================ */
@keyframes pulse-fast-primary {
  0%   { box-shadow: 0 0 0 0 rgba(0,90,156,0.35); }
  60%  { box-shadow: 0 0 0 10px rgba(0,90,156,0.0); }
  100% { box-shadow: 0 0 0 0 rgba(0,90,156,0.0); }
}

.btn--pulse-fast {
  animation: pulse-fast-primary 1.6s infinite;
}

    /* Muster Agents: außen wie Inlay (subtle), innen weiß */
#mod-presets.card.card--preset { 
  background: var(--subtle);  /* außen = Inlay-Farbe */
}

#mod-presets #sub-presets {
  background: #ffffff;        /* innen = weiß */
}

  </style>
</head>
<body>
  <!-- START: Startscreen -->
  <section id="start" class="centered">
    <div class="card start-card">
      <div class="container">
        <h1>Baukasten für Copilot-Chat-Agenten</h1>
        <p>Dieser Baukasten unterstützt dich dabei, einen vollständig einsatzbereiten Copilot Chat Agenten zu erstellen. Du wählst die gewünschten Eigenschaften aus, passt die erzeugten Textbausteine bei Bedarf an und kopierst anschließend das fertige Agenten Script in einen neuen Agent in Copilot.</p>
        <p>Viel Erfolg beim Erstellen deines Agents.</p>
        <div class="top-note" role="note" aria-label="Datenschutzhinweis">
          <h3>Datenschutzhinweis</h3>
          <p>Der Baukasten speichert keine persönlichen Daten. Alle Eingaben bleiben ausschließlich in deinem Browser und werden nicht an Server übertragen. Beim Schließen der Seite gehen nicht gespeicherte Inhalte verloren.</p>
        </div>
        
<div id="startButtons" style="display:flex; justify-content:space-between; align-items:center; gap:16px; margin-top:25px; width:100%">
  <button id="startBtn" class="btn">Baukasten starten</button>
  <button id="mainInfoBtn" class="info-btn info-pulse" type="button">Info zum Baukasten</button>
</div>

      </div>
    </div>
  </section>
  <!-- END: Startscreen -->

  <!-- START: Builder -->
  <section id="builder">
    <div class="container">
      <h1>Baukasten für Copilot-Chat-Agenten</h1>

      <div class="card">
  <h3>Hinweise zur Bedienung</h3>
<div class="muted">
  <p>Dieser Baukasten ist in logische Module unterteilt, die das Fundament für deinen Chat-Agenten bilden.</p>
  <p>In allen Modulen außer dem ersten kannst du die Texte in den <span class="demo-editable"><strong>grünen Feldern</strong></span> nach Bedarf anpassen.</p>
  
  <p>Bitte achte darauf, dass die <strong>inhaltliche Ausrichtung</strong> und die <strong>maximale Auswahl</strong> erhalten bleiben.</p>
  
  <p>Sobald dein Entwurf steht, lässt sich das Script mit einem Klick in die Zwischenablage kopieren. Unbearbeitete Module werden nicht in das Agenten-Script übernommen.</p>
  <p>Starte jetzt mit deiner persönlichen Auswahl oder nutze die Muster-Agents. Bei Unklarheiten klicke einfach auf die Hinweise-Buttons.</p>
  
  <p><strong>Viel Erfolg beim Erstellen!</strong></p>
</div>

<!-- MODUL: Muster Agents (neu) -->

<div class="card card--preset" id="mod-presets">
  
  <h2>Muster Agents</h2>

  <div class="subcard" id="sub-presets" style="margin-top:0;">
    <!-- Einleitung mit fetter Fragezeile (konsistent) -->
    <div class="subhint subhint--question" id="presetQuestion">Wähle einen vordefinierten Agents:</div>

    <!-- Auswahl (gleiches UI-Prinzip wie andere Boxen: select) -->
    <select id="presetSelect" size="6" aria-label="Muster Agent auswählen" aria-describedby="presetQuestion">

<option value="azubi_coach">Azubi‑Coach / Lernbegleiter</option>
<option value="klar_kurz">Klar & Kurz Agent</option>
<option value="ideen_coach">Ideen- & Kreativ-Coach</option>
<option value="excel_experte">Excel Experte</option>  
<option value="digital_assistent_o365">Digital‑Assistent – Office 365 Anwendungen</option>
<option value="office365_experte">Office 365 Experte</option>
<option value="email_datenprofi">E‑Mail & Datenprofi</option>
<option value="projekt_assistent">Projekt‑Assistent</option>
<option value="fuehrungscoach">Coach – Führung & Kommunikation</option>

</select>

    <!-- Erklärung (1 Satz) -->
    <div class="preview">
      <p id="presetDesc" class="muted"></p>
    </div>

    <!-- Aktionen -->
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_presets" aria-controls="infoPanel_presets" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="presetReset">Auswahl zurücksetzen</button>
    </div>

    <!-- Hinweis-Panel -->
    <div class="info-panel" id="infoPanel_presets" role="region" aria-label="Hinweise zu Muster Agents">
      <h4>Hinweise zu Muster Agents</h4>
      <p><strong>Auswahl:</strong> Wähle einen vordefinierten Agent aus der Liste aus.</p>
      <p><strong>Module:</strong> Die Einstellungen werden in den Modulen automatisch eingetragen.</p>
      <p><strong>Tipp:</strong> Die Auswahlen und Freitexte können nach Belieben angepasst werden.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>
</div>
   
      
      <!-- MODUL: Rolle / Persona (unverändert) -->
      <div class="card" id="mod-rolle">
        <h2>Rolle / Persona</h2>
        <div class="subcard">
          <h3 style="margin-top:0">Zuständigkeit</h3>
          <div class="subhint subhint--question">Wofür soll der Agent zuständig sein?</div>
          <div class="subhint subhint--choose">Wähle bis zu 3 Rollen:</div>
          <select id="rolleSelect" multiple size="8" aria-describedby="rolleCount rolleHint" aria-label="Rollen auswählen">
<option>Ausbildungsunterstützung, Azubi</option>
<option>Coach / Mentor</option>
<option>Einkauf / Verkauf, CSC</option>
<option>Engineering</option>
<option>Fachkraft Chemieproduktion</option>
<option>Fachkraft Technik</option>
<option>Fachkraft Wartung / Instandhaltung</option>
<option>Finance</option>
<option>Führungskraft</option>
<option>Gesundheit / Ernährung</option>
<option>HSE / Arbeitssicherheit</option>
<option>IT / Digital / Prozesse</option>
<option>Kommunikation / Training</option>
<option>Labor / QA</option>
<option>Office / Administration</option>
<option>Prozess- & Verfahrensingenieur</option>
<option>Recht / Steuern</option>
<option>Support & Lernen</option>
<option>Support & Service</option>
<option>Verwaltung, HR</option>
          </select>
          <div class="meta">
            <span id="rolleCount" aria-live="polite">0 / 3</span>
            <span class="hint" id="rolleHint" hidden>Maximale Anzahl erreicht.</span>
          </div>
          <div class="preview">
            <p>Dein Wirkungsbereich ist <span id="rolleBadge" class="badge-gray"></span>. Du agierst als professioneller, menschlicher Begleiter für diesen Kontext.</p>
          </div>
          <div class="actions-line">
            <button type="button" class="info-btn" id="infoBtn_rolle" aria-controls="infoPanel_rolle" aria-expanded="false">ℹ️ Hinweise</button>
            <button type="button" class="btn btn--sm" id="rolleReset">Zurücksetzen (Rolle/Persona)</button>
          </div>
          <div class="info-panel" id="infoPanel_rolle" role="region" aria-label="Hinweise zu Rolle / Persona">
            <h4>Hinweise zu Rollen / Persona</h4>
            <p><strong>Wofür?</strong> Festlegt den fachlichen Kontext (z. B. Ausbildung, HSE) – Beispiele, Ton und Prioritäten richten sich daran aus.</p>
            <p><strong>Keine Befugnisse:</strong> Nutze Kontext- statt Entscheidungsrollen.</p>
            <p><strong>Best Practice:</strong> 1–3 präzise Rollen wählen.</p>
            <button type="button" class="close-info">Verbergen</button>
          </div>
        </div>
      </div>

      <!-- MODUL: Purpose (unverändert) -->
      <div class="card" id="mod-purpose">
        <h2>Ziel / Purpose</h2>
        <div class="subcard">
          <h3 style="margin-top:0">Zweck</h3>
          <div class="subhint subhint--question">Welchen übergeordneten Zweck soll der Agent dienen?</div>
          <div class="subhint subhint--choose">Wähle bis zu 2 Zwecke:</div>
          <select id="purposeSelect" multiple size="8" aria-describedby="purposeCount purposeHint" aria-label="Zwecke auswählen">
            <option>Arbeitsalltag entlasten</option>
<option>Entscheidungen vorbereiten</option>
<option>Informationen strukturieren</option>
<option>Kommunikation verbessern</option>
<option>Konsistenz sicherstellen, z. B. Qualität von Texten</option>
<option>Lerninhalte aufbereiten</option>
<option>Prozesse vereinfachen</option>
<option>Risiken erkennen und Hinweise geben</option>
<option>Sicherheit erhöhen, Fehler vermeiden</option>
<option>Situationen klären, Orientierung geben</option>
<option>Standardaufgaben beschleunigen</option>
<option>Überblick schaffen, Komplexität reduzieren</option>
<option>Verständnis steigern, technisch und organisatorisch</option>
<option>Wissen vermitteln, erklären</option>
<option>Zusammenarbeit unterstützen</option>
          </select>
          <div class="meta">
            <span id="purposeCount" aria-live="polite">0 / 2</span>
            <span class="hint" id="purposeHint" hidden>Maximale Anzahl erreicht.</span>
          </div>
          <div class="preview">
            <p>Dein übergeordneter Zweck ist es, <span id="purposeEditable" class="editable" contenteditable="true"></span>. Du orientierst deine gesamte Arbeitsweise an diesem Ziel.</p>
          </div>
          <div class="actions-line">
            <button type="button" class="info-btn" id="infoBtn_purpose" aria-controls="infoPanel_purpose" aria-expanded="false">ℹ️ Hinweise</button>
            <button type="button" class="btn btn--sm" id="purposeReset">Zurücksetzen (Purpose)</button>
          </div>
          <div class="info-panel" id="infoPanel_purpose" role="region" aria-label="Hinweise zu Ziel / Purpose">
            <h4>Hinweise zu Ziel / Purpose</h4>
            <p><strong>Wirkung:</strong> Steuert Prioritäten (z. B. Sicherheit) und beeinflusst Tiefe/Struktur.</p>
            <p><strong>Auswahl:</strong> 1–2 klare Zwecke wählen.</p>
            <p><strong>Formulierung:</strong> Generisch statt interner Namen.</p>
            <button type="button" class="close-info">Verbergen</button>
          </div>
        </div>
      </div>

      <!-- MODUL: Aufgaben / Tasks (unverändert) -->
      <div class="card" id="mod-tasks">
        <h2>Auftrag / Task</h2>
        <div class="subcard">
          <h3 style="margin-top:0">Tätigkeiten</h3>
          <div class="subhint subhint--question">Welche konkrete Tätigkeit(en) soll der Agent ausüben?</div>
          <div class="subhint subhint--choose">Wähle bis zu 3 Tätigkeiten:</div>
          <select id="tasksSelect" multiple size="8" aria-describedby="tasksCount tasksHint" aria-label="Tätigkeiten auswählen">
           <option>Anleitungen formulieren</option>
<option>Daten oder Dokumente auslesen</option>
<option>Entscheidungsgrundlagen vorbereiten</option>
<option>Fragen beantworten</option>
<option>Hinweise oder Risiken aufzeigen</option>
<option>Informationen analysieren</option>
<option>Informationen strukturieren</option>
<option>Inhalte erklären</option>
<option>Inhalte zusammenfassen</option>
<option>Lerninhalte aufbereiten</option>
<option>Prozesse oder Abläufe darstellen</option>
<option>Texte erstellen</option>
<option>Texte überarbeiten</option>
          </select>
          <div class="meta">
            <span id="tasksCount" aria-live="polite">0 / 3</span>
            <span class="hint" id="tasksHint" hidden>Maximale Anzahl erreicht.</span>
          </div>
          <div class="preview">
            <p>Dein Auftrag umfasst folgende Tätigkeiten: <span id="tasksEditable" class="editable" contenteditable="true"></span>. Du führst diese Aufgaben verlässlich, klar strukturiert und nutzerorientiert aus.</p>
          </div>
          <div class="actions-line">
            <button type="button" class="info-btn" id="infoBtn_tasks" aria-controls="infoPanel_tasks" aria-expanded="false">ℹ️ Hinweise</button>
            <button type="button" class="btn btn--sm" id="tasksReset">Zurücksetzen (Tasks)</button>
          </div>
          <div class="info-panel" id="infoPanel_tasks" role="region" aria-label="Hinweise zu Aufgaben / Tasks">
            <h4>Hinweise zu Tätigkeiten</h4>
            <p><strong>Fokus:</strong> 80‑%‑Kernaufgaben priorisieren.</p>
            <p><strong>Balance:</strong> Max. 3 Tätigkeiten kombinieren.</p>
            <p><strong>Tipp:</strong> Bei Dokumenten „Daten/Dokumente auslesen“ ergänzen.</p>
            <button type="button" class="close-info">Verbergen</button>
          </div>
        </div>
      </div>

      <!-- MODUL: Kommunikationsstil (unverändert) -->
      <div class="card" id="mod-stil">
        <h2>Kommunikationsstil</h2>
        <div class="subcard">
          <h3 style="margin-top:0">Stil</h3>
          <div class="subhint subhint--question">Welchen Tonfall / welche Persönlichkeit soll der Agent verwenden?</div>
          <div class="subhint subhint--choose">Wähle genau eine Option:</div>
          <select id="stilSelect" size="6" aria-label="Kommunikationsstil wählen">
            <option>analytisch-technisch</option>
<option>didaktisch, erklärend</option>
<option>diplomatisch und wertschätzend</option>
<option>direkt und kompakt</option>
<option>formell und professionell</option>
<option>freundlich und unterstützend</option>
<option>kollegial, wie ein erfahrener Mitarbeiter</option>
<option>leicht ironisch, respektvoll</option>
<option>motivierend, coachend</option>
<option>neutral-sachlich</option>
<option>pragmatisch und lösungsorientiert</option>
<option>ruhig und klar</option>
<option>strukturiert und präzise</option>
<option>warm und menschlich</option>
          </select>
          <div class="preview">
            <p>Dein Kommunikationsstil ist: <span id="stilEditable" class="editable" contenteditable="true"></span>. Du hältst diesen Stil in Tonfall, Struktur und Wortwahl konsistent ein.</p>
          </div>
          <div class="actions-line">
            <button type="button" class="info-btn" id="infoBtn_stil" aria-controls="infoPanel_stil" aria-expanded="false">ℹ️ Hinweise</button>
            <button type="button" class="btn btn--sm" id="stilReset">Zurücksetzen (Stil)</button>
          </div>
          <div class="info-panel" id="infoPanel_stil" role="region" aria-label="Hinweise zum Kommunikationsstil">
            <h4>Hinweise zum Stil</h4>
            <p><strong>Passung:</strong> Stil zur Zielgruppe wählen.</p>
            <p><strong>Konsistenz:</strong> Ton, Wortwahl, Struktur durchhalten.</p>
            <p><strong>Tipp:</strong> „ruhig & klar“ + „strukturiert & präzise“ ist robust.</p>
            <button type="button" class="close-info">Verbergen</button>
          </div>
        </div>
      </div>

    <div class="card" id="mod-grundverhalten">
  <h2><strong>Grundverhalten / Arbeitslogik</strong></h2>

  <!-- 1) Startverhalten (Multi, limit 3, size 8) -->
  <div class="subcard" id="sub-startverhalten">
    <h3 style="margin-top:0">Startverhalten</h3>
    <div class="subhint subhint--question">Wie soll der Agent seine Antworten beginnen?</div>
    <div class="subhint subhint--choose">Wähle bis zu 3 Optionen:</div>
    <select id="startSelect" multiple size="8" aria-describedby="startCount startHint" aria-label="Startverhalten wählen">
     <option>direkter Start</option>
<option>kurzer Impuls</option>
<option>neutraler Startsatz</option>
<option>kurze Einordnung</option>
<option>kurze Zusammenfassung des Inputs</option>
<option>Überblick am Anfang</option>
<option>sachlich-klarer Einstieg</option>
<option>ruhiger Einstieg</option>
<option>freundlicher Einstieg</option>
    </select>
    <div class="meta">
      <span id="startCount" aria-live="polite">0 / 3</span>
      <span class="hint" id="startHint" hidden>Maximale Anzahl erreicht.</span>
    </div>
    <!-- Preview: kompletter Script-Satz mit Platzhalter -->
    <div class="preview">
      <p>Für den Einstieg nutzt du <span id="startEditable" class="editable" contenteditable="true"></span>, situativ und ohne wiederholende Muster.</p>
    </div>
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_start" aria-controls="infoPanel_start" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="startReset">Zurücksetzen (Start)</button>
    </div>
    <div class="info-panel" id="infoPanel_start" role="region" aria-label="Hilfetext Startverhalten">
      <h4>Hilfetext – Startverhalten</h4>
      <p><strong>Direkt vs. orientierend:</strong> Wähle 1–3 Einstiegstypen (z. B. „direkt“, „kurzer Impuls“, „Überblick“). Sie bestimmen nur den Startton, nicht die Dialoglogik.</p>
      <p><strong>Natürlichkeit:</strong> Einstiege werden situativ genutzt und nicht in jeder Antwort identisch wiederholt.</p>
      <p><strong>Abgrenzung:</strong> Rückfragen werden separat unter „Rückfragen‑Logik“ gesteuert, nicht hier.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>

  <!-- 2) Variation / Ausdruck (Multi, limit 3, size 8) -->
  <div class="subcard" id="sub-variation">
    <h3 style="margin-top:0">Variation / Ausdruck</h3>
    <div class="subhint subhint--question">Wie soll der sprachliche Ausdruck variieren?</div>
    <div class="subhint subhint--choose">Wähle bis zu 3 Optionen:</div>
    <select id="varSelect" multiple size="8" aria-describedby="variationCount variationHint" aria-label="Variation wählen">
      <option>Einstiegsformulierungen leicht variieren</option>
<option>kleine Variation bei Übergängen („Weiter…“, „Als Nächstes…“)</option>
<option>Wortwahl dezent variieren</option>
<option>dezente Synonyme statt Wiederholungen</option>
<option>Satzbau leicht variieren</option>
<option>Antwortlänge leicht variieren</option>
<option>Abschlussformulierungen variieren</option>
    </select>
    <div class="meta">
      <span id="variationCount" aria-live="polite">0 / 3</span>
      <span class="hint" id="variationHint" hidden>Maximale Anzahl erreicht.</span>
    </div>
    <!-- Preview: kompletter Script-Satz mit Platzhalter -->
    <div class="preview">
      <p>Du variierst deinen Ausdruck dezent durch <span id="varEditable" class="editable" contenteditable="true"></span>, damit Antworten natürlich und nicht repetitiv wirken.</p>
    </div>
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_variation" aria-controls="infoPanel_variation" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="varReset">Zurücksetzen (Variation)</button>
    </div>
    <div class="info-panel" id="infoPanel_variation" role="region" aria-label="Hilfetext Variation / Ausdruck">
      <h4>Hilfetext – Variation / Ausdruck</h4>
      <p><strong>Ziel:</strong> Leichte sprachliche Abwechslung für ein natürliches Lesegefühl.</p>
      <p><strong>Rahmen:</strong> Variation betrifft Wortwahl, Satzbau, Einstieg/Abschluss – Struktur und Inhalt bleiben gleich.</p>
      <p><strong>Grenze:</strong> Klarheit geht vor Abwechslung; keine künstliche Verlängerung.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>

  <!-- 3) Antwortstil / Spezifität (Single, size 8) -->
  <div class="subcard" id="sub-antwortstil">
    <h3 style="margin-top:0">Antwortstil / Spezifität</h3>
    <div class="subhint subhint--question">Wie soll der Agent seine Antworten aufbauen?</div>
    <div class="subhint subhint--choose">Wähle genau eine Option:</div>
    <select id="tiefeSelect" size="8" aria-label="Antwortstil wählen">
      <option>kompakt & direkt</option>
<option>ausführlich erklärend</option>
<option>schrittweise/strukturiert</option>
<option>technisch präzise</option>
<option>praxisnah mit Beispielen</option>
<option>klare Handlungsempfehlungen</option>
<option>Pro/Contra-Struktur</option>
<option>tabellarische Darstellung</option>
    </select>
    <!-- Preview: kompletter Script-Satz mit Platzhalter -->
    <div class="preview">
      <p>Deine Antworten folgen dem Stil <span id="tiefeEditable" class="editable" contenteditable="true"></span>, damit Inhalte klar, nachvollziehbar und strukturiert bleiben.</p>
    </div>
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_tiefe" aria-controls="infoPanel_tiefe" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="tiefeReset">Zurücksetzen (Antwortstil)</button>
    </div>
    <div class="info-panel" id="infoPanel_tiefe" role="region" aria-label="Hilfetext Antwortstil / Spezifität">
      <h4>Hilfetext – Antwortstil / Spezifität</h4>
      <p><strong>Aufgabe:</strong> Legt den inhaltlichen Aufbau fest.</p>
      <p><strong>Konsistenz:</strong> Eine Option wählen und konsequent beibehalten.</p>
      <p><strong>Tipp:</strong> „Schrittweise/strukturiert“ ist häufig ein guter Default.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>

  <!-- 4) Rückfragen-Logik (Single, size 8) -->
  <div class="subcard" id="sub-rueckfragen">
    <h3 style="margin-top:0">Rückfragen‑Logik</h3>
    <div class="subhint subhint--question">Wie soll der Agent Rückfragen einsetzen?</div>
    <div class="subhint subhint--choose">Wähle genau eine Option:</div>
    <select id="rqSelect" size="8" aria-label="Rückfragen-Logik wählen">
     <option>keine Rückfragen</option>
<option>Rückfragen nur bei Unklarheit (max. 1)</option>
<option>Scope-Frage bei Mehrdeutigkeit</option>
<option>Kontext klären (1 Frage)</option>
<option>Zielbild klären (1 Frage)</option>
<option>optionale Bestätigungsfrage („Soll ich weiter ins Detail gehen?“)</option>
<option>Rückfrage am Ende</option>
    </select>
    <!-- Preview: kompletter Script-Satz mit Platzhalter -->
    <div class="preview">
      <p>Deine Rückfragenlogik lautet: <span id="rqEditable" class="editable" contenteditable="true"></span>.</p>
    </div>
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_rq" aria-controls="infoPanel_rq" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="rqReset">Zurücksetzen (Rückfragen)</button>
    </div>
    <div class="info-panel" id="infoPanel_rq" role="region" aria-label="Hilfetext Rückfragen-Logik">
      <h4>Hilfetext – Rückfragen‑Logik</h4>
      <p><strong>Nutzen:</strong> Rückfragen erhöhen die Treffgenauigkeit, ohne den Fluss zu stören.</p>
      <p><strong>Begrenzung:</strong> Nur eine Regel – eindeutiges Verhalten.</p>
      <p><strong>Praxis:</strong> „Nur bei Unklarheit (max. 1)“ ist universell geeignet.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>

  <!-- 5) Recherche & Quellen (Single, size 8) -->
  <div class="subcard" id="sub-recherche">
    <h3 style="margin-top:0">Recherche & Quellen</h3>
    <div class="subhint subhint--question">Wie soll der Agent recherchieren und Quellen verwenden?</div>
    <div class="subhint subhint--choose">Wähle genau eine Option:</div>
    <select id="recSelect" size="8" aria-label="Rechercheverhalten wählen">
    <option>keine Websuche</option>
<option>Websuche nur bei externen Themen</option>
<option>Websuche bei Bedarf</option>
<option>vor Recherche einmal Rückfrage bei Unklarheit</option>
<option>Recherche präzise, keine Vermutungen</option>
<option>externe Infos als Stichpunkte</option>
<option>Websuche mit Quellenangabe (Titel/Datum/Link)</option>
    </select>
    <!-- Preview: kompletter Script-Satz mit Platzhalter -->
    <div class="preview">
      <p>Dein Recherche‑ und Quellenverhalten ist: <span id="recEditable" class="editable" contenteditable="true"></span>.</p>
    </div>
    <div class="actions-line">
      <button type="button" class="info-btn" id="infoBtn_recherche" aria-controls="infoPanel_recherche" aria-expanded="false">ℹ️ Hinweise</button>
      <button type="button" class="btn btn--sm" id="recReset">Zurücksetzen (Recherche)</button>
    </div>
    <div class="info-panel" id="infoPanel_recherche" role="region" aria-label="Hilfetext Recherche & Quellen">
      <h4>Hilfetext – Recherche & Quellen</h4>
      <p><strong>Transparenz:</strong> Bei externen Themen Quellen nennen.</p>
      <p><strong>Reihenfolge:</strong> Erst klären, dann recherchieren.</p>
      <p><strong>Sicherheit:</strong> Keine Vermutungen als Fakten ausgeben.</p>
      <button type="button" class="close-info">Verbergen</button>
    </div>
  </div>
</div>

      <!-- COPY -->
      <div class="card copy-area" id="copyArea">
        <div class="title-line">Kopiere nun das Agenten-Script in die Zwischenablage!</div>
       <button class="btn btn--pulse-fast" id="copyBtn">Kopieren in Zwischenablage</button>
        <div class="copy-msg" id="copyMsg">Das Agent‑Skript wurde in die Zwischenablage kopiert!</div>
      </div>

      <!-- Anleitung (immer sichtbar) -->
      <div class="card">
        <h2>Wie geht`s weiter? .... Kurze Anleitung</h2>
        <ol class="guide">
          
          <li><strong>Script Kopieren</strong><br/>
          Kopiere das Agenten-Script in dem Du auf den Button "Kopieren in Zwischenablage" klickst.</li>
          
          <li><strong>Neuen Agenten anlegen</strong><br/>
          Öffne in Copilot Chat den Punkt „Neuer Agent“. Dieser befindet sich in der linken Navigation.</li>

          <li><strong>Bezeichnung eintragen</strong><br/>
          Gib deinem Agenten einen kurzen, eindeutigen Namen. Beispiele: Office‑Assistent, Begleiter, Coach, Azubi‑Tutor.</li>

          <li><strong>Beschreibung eintragen</strong><br/>
          Beschreibe in ein bis zwei Sätzen, wofür der Agent gedacht ist.<br/>
          Beispiel: „Unterstützt bei täglichen Aufgaben, erklärt Inhalte verständlich und liefert klare, zuverlässige Antworten.“</li>

          <li><strong>Agent‑Script einfügen</strong><br/>
          Füge den aus dem Baukasten kopierten Text in das Feld <strong>„Anweisungen“</strong> ein. (re. Maustaste: Einfügen oder Tastenkombi: strg + V.</li>

          <li><strong>Agent speichern</strong><br/>
          Klicke oben rechts auf <strong>„Erstellen“</strong>, um den Agenten anzulegen und verfügbar zu machen.</li>

          <li><strong>Agent testen</strong><br/>
          Teste den Agent mit typischen Fragen aus deinem Arbeitsalltag und lasse den Baukasten währenddessen geöffnet!</li>

          <li><strong>Agent anpassen</strong><br/>
          Du kannst den Agent jederzeit weiter verfeinern.<br/>
          Klicke dazu neben dem Agent‑Symbol auf die drei Punkte und wähle <strong>„Bearbeiten“</strong>.<br/>
          Solange der Baukasten mit deinen Auswahlen noch geöffnet ist, kannst du Änderungen vornehmen und das aktualisierte Script erneut einfügen.</li>
        </ol>
      </div>

    </div>
  </section>
  <!-- END: Builder -->

  <script>
    // --- State ---
    const state = {
      rolle:   { selected: [], limit: 3, edited:false },
      purpose: { selected: [], limit: 2, edited:false },
      tasks:   { selected: [], limit: 3, edited:false },
      // V5.2: Start & Variation als Multi mit Limit 3
      start:     { selected: [], limit: 3, edited:false },
      variation: { selected: [], limit: 3, edited:false },
      tiefe:     { selected: '', edited:false },     // "Antwortstil / Spezifität"
      rq:        { selected: '', edited:false },
      recherche: { selected: '', edited:false },
      stil:      { selected: '', edited:false }
    };

    // --- Helpers ---
    const qs = (sel, root=document) => root.querySelector(sel);
    const joinList = (arr) => arr.join(', ');
    const textOrEmpty = (selector) => (qs(selector)?.textContent || '').trim();

    // Toggle-Multi ohne STRG/⌘
    function enableClickToggle(selectEl, key){
      selectEl.addEventListener('mousedown', (e) => {
        const opt = e.target;
        if(opt && opt.tagName === 'OPTION'){
          e.preventDefault();
          opt.selected = !opt.selected;
          selectEl.dispatchEvent(new Event('change', {bubbles:true}));
          selectEl.focus();
        }
      });
    }

    function enforceMultiLimit(selectEl, key){
      const { limit } = state[key];
      const current = Array.from(selectEl.options).filter(o=>o.selected).map(o=>o.text);
      const prev = state[key].selected.slice();
      const kept = prev.filter(x=>current.includes(x));
      const added = current.filter(x=>!prev.includes(x));
      const merged = kept.concat(added);
      if(merged.length > limit){
        const toDeselect = merged.slice(limit);
        Array.from(selectEl.options).forEach(o => { if(toDeselect.includes(o.text)) o.selected = false; });
        state[key].selected = merged.slice(0, limit);
      } else {
        state[key].selected = merged;
      }
      // Counter + Hinweis + Lock nicht-gewählter Optionen
      const idBase = key;
      const countEl = qs(`#${idBase}Count`);
      const hintEl  = qs(`#${idBase}Hint`);
      if(countEl) countEl.textContent = `${state[key].selected.length} / ${limit}`;
      const atMax = state[key].selected.length >= limit;
      if(hintEl) hintEl.hidden = !atMax;
      Array.from(selectEl.options).forEach(o => { if(!o.selected) o.disabled = atMax; });
      updateEditableFromSelection(key);
    }

   function updateEditableFromSelection(key){
  // Rolle: nicht editierbar → Badge füllen
  if (key === 'rolle') {
    qs('#rolleBadge').textContent = joinList(state.rolle.selected);
    return;
  }

  const map = {
    purpose:   { span: '#purposeEditable',   value: joinList(state.purpose.selected)   },
    tasks:     { span: '#tasksEditable',     value: joinList(state.tasks.selected)     },
    start:     { span: '#startEditable',     value: joinList(state.start.selected)     },
    variation: { span: '#varEditable',       value: joinList(state.variation.selected) },
    tiefe:     { span: '#tiefeEditable',     value: state.tiefe.selected               },
    rq:        { span: '#rqEditable',        value: state.rq.selected                  },
    recherche: { span: '#recEditable',       value: state.recherche.selected           },
    stil:      { span: '#stilEditable',      value: state.stil.selected                }
  };

  const target = map[key];
  if (!target) return;

  const span = qs(target.span);
  const newVal = target.value ?? '';
  const curVal = (span.textContent || '').trim();

  // Überschreibe, wenn:
  // - Feld leer ist ODER
  // - Feld noch exakt dem (letzten) Auswahl-Join entspricht ODER
  // - der Nutzer nicht bewusst „entkoppelt“ hat (edited=false)
  if (!state[key]?.edited || curVal === '' || curVal === newVal) {
    span.textContent = newVal;
  }
}

    function updateSingleSelect(selectEl, key){
      const val = selectEl.value || '';
      state[key].selected = val;
      if(state[key].edited) return;
      const spanId = ({ tiefe:'#tiefeEditable', rq:'#rqEditable', recherche:'#recEditable', stil:'#stilEditable' })[key];
      if(spanId) qs(spanId).textContent = val;
    }

    function resetModule(key){
      switch(key){
        case 'rolle':{
          const el = qs('#rolleSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
          state.rolle.selected = []; qs('#rolleCount').textContent = `0 / ${state.rolle.limit}`; qs('#rolleHint').hidden = true; qs('#rolleBadge').textContent = ''; break;
        }
        case 'purpose':{
          const el = qs('#purposeSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
          state.purpose.selected = []; state.purpose.edited=false; qs('#purposeCount').textContent=`0 / ${state.purpose.limit}`; qs('#purposeHint').hidden=true; qs('#purposeEditable').textContent=''; break;
        }
        case 'tasks':{
          const el = qs('#tasksSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
          state.tasks.selected=[]; state.tasks.edited=false; qs('#tasksCount').textContent=`0 / ${state.tasks.limit}`; qs('#tasksHint').hidden=true; qs('#tasksEditable').textContent=''; break;
        }
        case 'start':{
          const el = qs('#startSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
          state.start.selected=[]; state.start.edited=false; qs('#startEditable').textContent=''; qs('#startCount').textContent=`0 / ${state.start.limit}`; qs('#startHint').hidden=true; break;
        }
        case 'variation':{
          const el = qs('#varSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
          state.variation.selected=[]; state.variation.edited=false; qs('#varEditable').textContent=''; qs('#variationCount').textContent=`0 / ${state.variation.limit}`; qs('#variationHint').hidden=true; break;
        }
        case 'tiefe':{ qs('#tiefeSelect').selectedIndex=-1; state.tiefe.selected=''; state.tiefe.edited=false; qs('#tiefeEditable').textContent=''; break; }
        case 'rq':{ qs('#rqSelect').selectedIndex=-1; state.rq.selected=''; state.rq.edited=false; qs('#rqEditable').textContent=''; break; }
        case 'recherche':{ qs('#recSelect').selectedIndex=-1; state.recherche.selected=''; state.recherche.edited=false; qs('#recEditable').textContent=''; break; }
        case 'stil':{ qs('#stilSelect').selectedIndex=-1; state.stil.selected=''; state.stil.edited=false; qs('#stilEditable').textContent=''; break; }
      }
    }

    function getModuleTextFromEditableOrSelection(spanSelector, selected){
      const t = textOrEmpty(spanSelector);
      if(t) return t;
      if(Array.isArray(selected)) return selected.length ? joinList(selected) : '';
      return selected || '';
    }

    // Script generieren – neue Reihenfolge + neue Sätze (nur Grundverhalten)
    function buildScript(){
      const parts = [];

      // 1) Rolle/Persona
      if(state.rolle.selected.length){
        const rolle = joinList(state.rolle.selected);
        parts.push(`[Rolle / Persona]
Dein Wirkungsbereich ist ${rolle}. Du agierst als professioneller, menschlicher Begleiter für diesen Kontext.`);
      }

      // 2) Purpose
      const purpose = getModuleTextFromEditableOrSelection('#purposeEditable', state.purpose.selected);
      if(purpose){
        parts.push(`[Ziel / Purpose]
Dein übergeordneter Zweck ist es, ${purpose}. Du orientierst deine gesamte Arbeitsweise an diesem Ziel.`);
      }

      // 3) Tasks
      const tasks = getModuleTextFromEditableOrSelection('#tasksEditable', state.tasks.selected);
      if(tasks){
        parts.push(`[Auftrag / Task]
Dein Auftrag umfasst folgende Tätigkeiten: ${tasks}. Du führst diese Aufgaben verlässlich, klar strukturiert und nutzerorientiert aus.`);
      }

      // 4) Grundverhalten – NEU (nur wenn Felder gefüllt sind)
      const startSel     = getModuleTextFromEditableOrSelection('#startEditable', state.start.selected);
      const variationSel = getModuleTextFromEditableOrSelection('#varEditable', state.variation.selected);
      const antwortstil  = getModuleTextFromEditableOrSelection('#tiefeEditable', state.tiefe.selected);
      const rueckfragen  = getModuleTextFromEditableOrSelection('#rqEditable', state.rq.selected);
      const rechercheSel = getModuleTextFromEditableOrSelection('#recEditable', state.recherche.selected);

      const g = [];
      if(startSel)     g.push(`Für den Einstieg nutzt du ${startSel}, situativ und ohne wiederholende Muster.`);
      if(variationSel) g.push(`Du variierst deinen Ausdruck dezent durch ${variationSel}, damit Antworten natürlich und nicht repetitiv wirken.`);
      if(antwortstil)  g.push(`Deine Antworten folgen dem Stil ${antwortstil}, damit Inhalte klar, nachvollziehbar und strukturiert bleiben.`);
      if(rueckfragen)  g.push(`Deine Rückfragenlogik lautet: ${rueckfragen}.`);
      if(rechercheSel) g.push(`Dein Recherche- und Quellenverhalten ist: ${rechercheSel}.`);

      if(g.length){
        parts.push(`[Grundverhalten / Arbeitslogik]
Du arbeitest nach folgender festen Logik:

${g.join('\n\n')}`);
      }

      // 5) Kommunikationsstil
      const stil = getModuleTextFromEditableOrSelection('#stilEditable', state.stil.selected);
      if(stil){
        parts.push(`[Kommunikationsstil]
Dein Kommunikationsstil ist: ${stil}. Du hältst diesen Stil in Tonfall, Struktur und Wortwahl konsistent ein.`);
      }

      // 6) Feste Blöcke (unverändert)
      const fixBlocks = [
`[Formatoption (situativ nachgelagert)]
Biete nach der ersten Antwort optional an, das Ergebnis in einem gewünschten Format darzustellen (z. B. Schritte, Varianten, Pro/Contra, Formulierungen). Frag nur bei erkennbarem Strukturbedarf; sonst entscheide situativ.`,
`[Compliance DSGVO]
Du hältst dich jederzeit an Datenschutz, Vertraulichkeit, Sicherheit und professionelle Grenzen. Nie Diagnosen erfragen; nur arbeitsrelevante Einschränkungen klären.`,
`[Grenzen]
Keine Diagnosen oder medizinischen Aussagen; keine psychologischen Interpretationen; keine Rechtsberatung. Keine Beratung zu Kindern, Familie oder privaten Ursachen.
Bei privaten Belastungen: freundlich bleiben, Rolle klären, beruflichen Rahmen sortieren (Prioritäten, Ruhe, Arbeitsfähigkeit).
Bei gesundheitlichen Belastungen, auffälligen Fehlzeiten, eskalierten Konflikten oder Themen außerhalb deiner Rolle: Hinweise geben, dass HR/BGM/Betriebsrat eingebunden werden sollte. Immer sachlich, respektvoll, neutral, ohne persönliche Abwertungen.`,
`[Out-of-Scope]
Du kommunizierst klar, wenn eine Anfrage außerhalb des Zuständigkeitsbereiches liegt, und bietest dann sichere, fachlich passende Alternativen an.`,
`[Universelle Fehler- & Klarheitslogik]
Wenn Informationen fehlen, unklar oder widersprüchlich sind, frage einmal präzise nach, triff keine Annahmen und arbeite nicht mit Vermutungen. Bleibe faktentreu, biete bei Bedarf Optionen an und mach transparent, wenn du ohne Klärung nicht sinnvoll weitermachen kannst.`,
`[Konsistenz- & Lückenmanagement]
Prüfe Nutzerangaben auf Konsistenz, vermeide Endlos-Schleifen (max. eine Nachfrage) und halte Grenzen klar fest: Sag offen, wenn dir verlässliche Infos fehlen oder der Auftrag außerhalb deines Handlungsspielraums liegt.`,
`[Kommunikatives Eskalationsmodell]
Arbeite in vier Schritten:
(1) kurze offene Klärung,
(2) Konkretisierung mit Fokus,
(3) Konsequenz nach zwei unklaren Antworten („Ich kann ohne Klärung nicht weiterhelfen.“),
(4) Hinweis, dass das Thema ggf. einer formalen Prüfung durch zuständige Stellen bedarf.`,
`[Transparenzpflicht]
Sag früh und klar, welche Information du brauchst, um eine qualifizierte Antwort zu geben.`,
`[Werte & Unternehmensbezug]
Werte: Sicherheit, Qualität, respektvolles Verhalten, Herausforderung, Gewinnen. Werte nur nennen, wenn sie Orientierung geben („…damit wir Qualität/Sicherheit sichern.“). Trade-offs benennen; Sicherheit und Respekt priorisieren. Orientierung: mutig, klar, lösungsorientiert, ohne Drama.`
      ];
      parts.push(...fixBlocks);

      return parts.join('\n\n').trim();
    }

    // Info-Panels
    function wireInfoPanel(key){
      const btn = qs(`#infoBtn_${key}`);
      const panel = qs(`#infoPanel_${key}`);
      if(!btn || !panel) return;
      const closeBtn = panel.querySelector('.close-info');
      function open(){ panel.style.display='block'; btn.setAttribute('aria-expanded','true'); closeBtn && closeBtn.focus(); }
      function close(){ panel.style.display='none'; btn.setAttribute('aria-expanded','false'); btn.focus(); }
      btn.addEventListener('click', ()=>{ const openNow = panel.style.display==='block'; openNow?close():open(); });
      closeBtn && closeBtn.addEventListener('click', close);
      panel.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
    }

    async function copyToClipboard(text){
      try{
        if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(text); }
        else { const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.focus(); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }
        return true;
      }catch(e){ console.error(e); return false; }
    }

    // Wiring
    window.addEventListener('DOMContentLoaded', ()=>{
      

// Start -> Builder
qs('#startBtn').addEventListener('click', () => {
  qs('#start').style.display='none';
  qs('#builder').style.display='block';

  // NEU: Auf Seitenanfang scrollen, damit H1 und der neue Kasten sichtbar sind
  window.scrollTo({ top: 0, left: 0, behavior: 'instant' });

  // NEU: Fokus zuerst auf den neuen Preset-Select setzen; falls nicht vorhanden, fallback
  const presetSel = qs('#presetSelect');
  if (presetSel) { presetSel.focus(); }
  else { qs('#rolleSelect').focus(); }
});

      // Info-Panels
      ['rolle','purpose','tasks','start','variation','tiefe','rq','recherche','stil'].forEach(wireInfoPanel);

      // Multi-Selects (inkl. Start/Variation)
      [
        {sel:'#rolleSelect', key:'rolle'},
        {sel:'#purposeSelect', key:'purpose'},
        {sel:'#tasksSelect', key:'tasks'},
        {sel:'#startSelect', key:'start'},
        {sel:'#varSelect', key:'variation'}
      ].forEach(d=>{
        const el = qs(d.sel);
        enableClickToggle(el, d.key);
        el.addEventListener('change', e=>enforceMultiLimit(e.target, d.key));
      });

      // Single-Selects
      qs('#tiefeSelect').addEventListener('change', e=>updateSingleSelect(e.target, 'tiefe'));
      qs('#rqSelect').addEventListener('change', e=>updateSingleSelect(e.target, 'rq'));
      qs('#recSelect').addEventListener('change', e=>updateSingleSelect(e.target, 'recherche'));
      qs('#stilSelect').addEventListener('change', e=>updateSingleSelect(e.target, 'stil'));

      // Editable-Flags
      qs('#purposeEditable').addEventListener('input', ()=> state.purpose.edited = true);
      qs('#tasksEditable').addEventListener('input', ()=> state.tasks.edited   = true);

     qs('#startEditable').addEventListener('input', () => {
  const joined = joinList(state.start.selected);
  state.start.edited = (qs('#startEditable').textContent || '').trim() !== joined;
});
qs('#varEditable').addEventListener('input', () => {
  const joined = joinList(state.variation.selected);
  state.variation.edited = (qs('#varEditable').textContent || '').trim() !== joined;
});
      qs('#tiefeEditable').addEventListener('input', ()=> state.tiefe.edited   = true);
      qs('#rqEditable').addEventListener('input',    ()=> state.rq.edited      = true);
      qs('#recEditable').addEventListener('input',   ()=> state.recherche.edited = true);
      qs('#stilEditable').addEventListener('input',  ()=> state.stil.edited    = true);

      // Resets
      qs('#rolleReset').addEventListener('click',   ()=>resetModule('rolle'));
      qs('#purposeReset').addEventListener('click', ()=>resetModule('purpose'));
      qs('#tasksReset').addEventListener('click',   ()=>resetModule('tasks'));
      qs('#startReset').addEventListener('click',   ()=>resetModule('start'));
      qs('#varReset').addEventListener('click',     ()=>resetModule('variation'));
      qs('#tiefeReset').addEventListener('click',   ()=>resetModule('tiefe'));
      qs('#rqReset').addEventListener('click',      ()=>resetModule('rq'));
      qs('#recReset').addEventListener('click',     ()=>resetModule('recherche'));
      qs('#stilReset').addEventListener('click',    ()=>resetModule('stil'));

      // Copy
      qs('#copyBtn').addEventListener('click', async ()=>{
        const script = buildScript();
        const ok = await copyToClipboard(script);
        const msg = qs('#copyMsg');
        msg.style.display = ok ? 'block' : 'none';
        if(!ok) alert('Kopieren nicht möglich. Bitte manuell kopieren.');
        if(ok) setTimeout(()=> msg.style.display='none', 4000);
      });
    });
  // === Info-Modal Logic (DOMContentLoaded, isolated) ===
  document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('infoModal');
    var openBtn = document.getElementById('mainInfoBtn');
    var closeX = document.getElementById('closeInfo');
    var steps = modal ? modal.querySelectorAll('.info-step') : [];
    var nextBtn = document.getElementById('nextStep');
    var prevBtn = document.getElementById('prevStep');
    var stepDots = document.getElementById('stepDots');
    var current = 0;

    function update() {
      steps.forEach(function(s, i){ s.classList.toggle('active', i === current); });
      if (prevBtn) prevBtn.style.visibility = current === 0 ? 'hidden' : 'visible';
      if (nextBtn) nextBtn.textContent = current === steps.length - 1 ? 'Verstanden' : 'Weiter';
      if (stepDots) stepDots.textContent = Array.from({length: steps.length}, function(_, i){ return i === current ? '●' : '○'; }).join(' ');
    }

    if (openBtn) openBtn.addEventListener('click', function(){ if(!modal) return; modal.style.display='flex'; current = 0; update(); });
    if (closeX) closeX.addEventListener('click', function(){ if(!modal) return; modal.style.display='none'; });
    if (nextBtn) nextBtn.addEventListener('click', function(){ if (current < steps.length - 1) { current++; update(); } else if (modal) { modal.style.display='none'; } });
    if (prevBtn) prevBtn.addEventListener('click', function(){ if (current > 0) { current--; update(); } });
    if (modal) modal.addEventListener('click', function(e){ if (e.target === modal) modal.style.display='none'; });
  });
  // === End Info-Modal Logic ===
</script>
<!-- Info-Modal: Optionale Info-Ebene -->
<div id="infoModal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <span id="closeInfo" class="close-x" role="button" aria-label="Schließen">&times;</span>

    <!-- SCREEN 1 -->
    <div class="info-step active" data-step="1">
      <h3>Was macht dieser Baukasten?</h3>
      <p>Dieser Baukasten erstellt Copilot‑Agenten, die verlässlich, klar und strukturiert arbeiten.</p>

      <p>Mit wenigen Auswahlfeldern bestimmst du:</p>
      <ul>
        <li>wie ein Agent antwortet</li>
        <li>wie er kommuniziert</li>
        <li>wie er mit Rückfragen, Recherche und Unklarheiten umgeht</li>
        <li>wie er seine Aufgaben strukturiert</li>
      </ul>
<br>
      <p>Der Fokus liegt auf Verhalten, Ton und Arbeitsweise.</p>
      <p>Die fachlichen Fähigkeiten bringt Copilot bereits vollständig mit.</p>
      <p>Der Baukasten sorgt dafür, dass sie gezielt, nachvollziehbar und konsistent eingesetzt werden.</p>
    </div>

    <!-- SCREEN 2 -->
    <div class="info-step" data-step="2">
      <h3>Wie funktioniert das?</h3>

      <p>Du stellst dir einen Agenten zusammen, indem du fünf Bereiche auswählst:</p>

      <p><strong>Rolle / Persona</strong><br>Welcher Grundstil? (z. B. sachlich, unterstützend, technisch)</p>

      <p><strong>Purpose (Ziel)</strong><br>Was soll der Agent grundsätzlich erreichen?<br>(z. B. Prozesse vereinfachen, Aufgaben beschleunigen)</p>

      <p><strong>Tasks (Arbeitsauftrag)</strong><br>Was macht der Agent typischerweise?<br>(z. B. analysieren, strukturieren, erklären)</p>

      <p><strong>Kommunikationsstil</strong><br>Wie klingt der Agent?<br>(z. B. ruhig & klar, analytisch, kompakt)</p>

      <p><strong>Grundverhalten</strong><br>Wie arbeitet der Agent?</p>
      <ul>
        <li>Wie er startet</li>
        <li>Wie tief er antwortet</li>
        <li>Wann er Rückfragen stellt</li>
        <li>Wie er recherchiert</li>
        <li>Wie natürlich er formuliert</li>
      </ul>
<br>
      <p>Durch diese Einstellungen entsteht ein klar definiertes Regelwerk, das den Agenten stabil, klar und vorhersehbar macht.</p>
    </div>

    <!-- SCREEN 3 -->
    <div class="info-step" data-step="3">
      <h3>Was passiert im Hintergrund?</h3>

      <p>Der Baukasten setzt alle Entscheidungen in ein strukturiertes Regelwerk um. Dieses Regelwerk steuert:</p>
      <ul>
        <li>Tonfall</li>
        <li>Struktur</li>
        <li>Antwort-Niveau</li>
        <li>Rückfragenverhalten</li>
        <li>Recherche‑Verhalten</li>
        <li>Variationen im Ausdruck</li>
        <li>Umgang mit unklaren Situationen</li>
        <li>Grenzen (keine Diagnosen, keine Rechtsauskünfte usw.)</li>
        <li>Transparenz, Konsistenz</li>
        <li>Datenschutz‑Hinweise</li>
      </ul>
<br>
      <p>Das erzeugte Script ist klar, konsistent und universell – und genau das macht die Agenten verlässlich.</p>
      <p>Zusätzlich werden feste Bestandteile in das Script eingebaut. So z. B. Eskalationsstufen und DSGVO.</p>
    </div>

    <!-- SCREEN 4 -->
    <div class="info-step" data-step="4">
      <h3>Wie setzt der Agent deine Einstellungen um?</h3>

      <p>Die Auswahl im Baukasten bildet die oberste Steuerlogik des Agenten. </p>
        
       <p> Diese Anweisungen haben Vorrang vor:</p>
      <ul>
        <li>benutzerdefinierten Copilot‑Einstellungen</li>
        <li>persönlichen Erinnerungen</li>
        <li>spontanen Stiländerungen</li>
        <li>dem Standard‑Verhalten der KI</li>
      </ul>
<br>
      <p>Der Agent folgt dadurch konsequent:</p>
      <ul>
        <li>dem gewählten Ton</li>
        <li>dem definierten Arbeitsverhalten</li>
        <li>der gewünschten Struktur</li>
        <li>der festgelegten Rückfragen‑ und Recherchelogik</li>
      </ul>
<br>
      <p>Gleichzeitig nutzt er alle Fähigkeiten, die Copilot bereits mitbringt, wendet sie aber innerhalb deiner definierten Regeln an – konsistent, kontrolliert und ohne Stilbrüche.</p>
    </div>

    <!-- NAVIGATION -->
    <div class="step-nav">
      <button id="prevStep" class="btn btn--sm" type="button">Zurück</button>
      <div id="stepDots" class="muted" aria-live="polite"></div>
      <button id="nextStep" class="btn btn--sm" type="button">Weiter</button>
    </div>
  </div>

<script>
/* ======================================================================
   PRESET-ENGINE – vollständig, minimalinvasiv, kompatibel
   Fügt vordefinierte Agenten ein und steuert Auswahl + Reset.
   NICHTS im bestehenden Baukasten wird überschrieben.
====================================================================== */

// -----------------------
// PRESET-DATEN
// -----------------------
const PRESETS = {
"klar_kurz": {
  desc: "Kompakte, gut strukturierte Antworten mit kurzen Überschriften und sinnvollen Abschnitten.",
  rolle: ["Office / Administration", "Kommunikation / Training"],
  purpose: ["Arbeitsalltag entlasten", "Informationen strukturieren"],
  tasks: ["Informationen analysieren", "Inhalte erklären", "Informationen strukturieren"],
  start: ["direkter Start"],
  variation: ["Wortwahl dezent variieren"],
  tiefe: "kompakt & direkt",
  rq: "Rückfrage am Ende",
  recherche: "Websuche mit Quellenangabe (Titel/Datum/Link)",
  stil: "direkt und kompakt",
  edit: {
    purpose: "Arbeitsalltag entlasten und Informationen klar strukturieren.",
    tasks: "Informationen analysieren, Inhalte erklären und strukturiert darstellen.",
    start: "Kurzer Einstieg in 1–2 Sätzen ohne Meta-Kommentare.",
    tiefe: "Kompakt und gut lesbar: kurzer Einstiegssatz, dann klare Zwischenüberschriften, jeweils ein kurzer Absatz und kurze Listen mit je 1 erklärenden Satz. Keine Floskeln.",
    stil: "Klar, sachlich und modern. Kurze Sätze, natürliche Struktur, keine Ausschmückungen.",
    rq: "Am Ende zwei kurze, sinnvolle Anschlussfragen.",
    recherche: "Websuche mit Titel/Datum/Link; keine Aussagen über fehlenden Zugriff."
  }
},

  
  "email_datenprofi": {
    desc: "Optimiert Texte, E‑Mails und Inhalte – klar, präzise und strukturiert.",
    rolle: ["Kommunikation / Training"],
    purpose: ["Kommunikation verbessern", "Konsistenz sicherstellen, z. B. Qualität von Texten"],
    tasks: ["Texte überarbeiten", "Texte erstellen", "Informationen strukturieren"],
    start: ["kurzer Impuls"],
    variation: ["dezente Synonyme statt Wiederholungen"],
    tiefe: "klare Handlungsempfehlungen",
    rq: "Kontext klären (1 Frage)",
    recherche: "Websuche bei Bedarf",
    stil: "formell und professionell",
    edit: {
      purpose: "Kommunikation verbessern, konsistente Texte sicherstellen.",
      tasks: "Texte überarbeiten, Texte erstellen, Inhalte klar strukturieren.",
      start: "kurzer Impuls; sofort zum Punkt.",
      variation: "dezente Synonyme; keine künstliche Länge.",
      tiefe: "klare Schritte, klare Botschaft, klare Empfehlung.",
      rq: "Eine Rückfrage: Zielgruppe oder Zweck der Nachricht klären.",
      recherche: "Nur bei externen Themen Websuche; keine Spekulation.",
      stil: "kurze Sätze, sachlich, höflich-professionell."
    }
  },
  "excel_experte": {
    desc: "Analysiert Excel-Daten, erklärt Formeln präzise und liefert klare Handlungsschritte.",
    rolle: ["IT / Digital / Prozesse"],
    purpose: ["Prozesse vereinfachen", "Überblick schaffen, Komplexität reduzieren"],
    tasks: ["Informationen analysieren", "Prozesse oder Abläufe darstellen", "Anleitungen formulieren"],
    start: ["sachlich-klarer Einstieg"],
    variation: ["Wortwahl dezent variieren"],
    tiefe: "technisch präzise",
    rq: "Kontext klären (1 Frage)",
    recherche: "Websuche bei Bedarf",
    stil: "analytisch-technisch",
    edit: {
      purpose: "Daten analysieren, Abläufe vereinfachen, Verständnis erhöhen.",
      tasks: "Excel-Daten analysieren, Formeln erklären, klare Schritte liefern.",
      start: "kurz, technisch, ohne Floskeln.",
      variation: "minimal; keine unnötigen Synonyme.",
      tiefe: "Formeln exakt darstellen. Schrittweise Analyse: 1) Problem, 2) Formel, 3) Beispiel, 4) Fehlerquelle. Bei Pivot: Felder → Zeilen/Spalten → Werte → Filter. Bei PowerQuery: Quelle → Transform → Laden.",
      rq: "Eine Klärfrage: Excel Desktop, Online oder Mac-Version?",
      recherche: "Websuche bei neueren Excel-Funktionen oder Syntaxänderungen.",
      stil: "präzise, klar, ohne Ausschmückung."
    }
  },
  "fuehrungscoach": {
    desc: "Begleitet Führungssituationen klar, strukturiert und respektvoll.",
    rolle: ["Coach / Mentor", "Führungskraft"],
    purpose: ["Situationen klären, Orientierung geben"],
    tasks: ["Inhalte erklären", "Hinweise oder Risiken aufzeigen"],
    start: ["ruhiger Einstieg"],
    variation: ["kleine Variation bei Übergängen („Weiter…“, „Als Nächstes…“)"],
    tiefe: "Pro/Contra-Struktur",
    rq: "Zielbild klären (1 Frage)",
    recherche: "keine Websuche",
    stil: "diplomatisch und wertschätzend",
    edit: {
      purpose: "Orientierung geben, Situationen strukturieren, Entscheidungen unterstützen.",
      tasks: "Hinweise geben, Argumente sortieren, Optionen erklären.",
      start: "ruhig, klar, ohne Dringlichkeit.",
      variation: "sehr dezent; Fokus auf Konsistenz.",
      tiefe: "Pro/Contra: je 2–3 Punkte. Empfehlung benennen. Risiken klar sagen, ohne Druck. How-to: max. 5 Schritte für Gesprächsführung.",
      rq: "Eine Rückfrage: gewünschtes Ziel des Gesprächs?",
      recherche: "keine externen Quellen; Fokus auf Prinzipien und Rollen.",
      stil: "ruhig, wertschätzend, respektvoll."
    }
  },
  "office365_experte": {
    desc: "Erklärt moderne Microsoft 365 Anwendungen klar, aktuell und mit Webquellen.",
    rolle: ["IT / Digital / Prozesse"],
    purpose: ["Verständnis steigern, technisch und organisatorisch", "Prozesse vereinfachen"],
    tasks: ["Inhalte erklären", "Anleitungen formulieren", "Informationen analysieren"],
    start: ["kurze Einordnung"],
    variation: ["kleine Variation bei Übergängen („Weiter…“, „Als Nächstes…“)"],
    tiefe: "schrittweise/strukturiert",
    rq: "Kontext klären (1 Frage)",
    recherche: "Websuche mit Quellenangabe (Titel/Datum/Link)",
    stil: "didaktisch, erklärend",
    edit: {
      purpose: "Verständnis für Office 365 erhöhen und richtige Funktionen präzise erklären.",
      tasks: "Office‑Anwendungen erklären, How‑to‑Schritte geben, Unterschiede klären.",
      start: "kurze Einordnung: App, Version, Oberfläche.",
      variation: "dezente Variation, Fokus auf Klarheit.",
      tiefe: "How‑to: maximal 7 Schritte. Immer zuerst klären: App, Plattform (Web/Desktop/Mobil), Tenant/Version. Schritte: 1) Oberfläche, 2) Navigation, 3) Aktion, 4) Kontrolle.",
      rq: "Eine Rückfrage: Welche App (Loop, Planner, OneNote, Teams) und welche Plattform?",
      recherche: "Immer Websuche mit Titel/Datum/Link für aktuelle UI oder Funktionsänderungen.",
      stil: "klar, erklärend, ohne Floskeln."
    }
  },
  "azubi_coach": {
    desc: "Erklärt Inhalte in einfacher Sprache, arbeitet Schritt‑für‑Schritt und bietet kurze Mini‑Checks an.",
    rolle: ["Ausbildungsunterstützung, Azubi", "Support & Lernen"],
    purpose: ["Wissen vermitteln, erklären", "Situationen klären, Orientierung geben"],
    tasks: ["Lerninhalte aufbereiten", "Inhalte erklären", "Anleitungen formulieren"],
    start: ["ruhiger Einstieg", "kurze Einordnung"],
    variation: ["Wortwahl dezent variieren"],
    tiefe: "schrittweise/strukturiert",
    rq: "Kontext klären (1 Frage)",
    recherche: "Websuche bei Bedarf",
    stil: "freundlich und unterstützend",
    edit: {
      purpose: "Komplexe Inhalte in einfacher Sprache erklären; Schritt‑für‑Schritt; am Ende Mini‑Check (1–2 Fragen).",
      tasks: "Erklären → Beispiel → Mini‑Übung (1 Aufgabe) → Lösungshinweis. Bei Unsicherheit: eine Klärfrage.",
      start: "Ruhig starten, 1‑Satz‑Einordnung; danach 3–5 klare Schritte.",
      variation: "Sehr dezent; keine Floskeln.",
      tiefe: "Jeder Schritt: 1 Aktion + 1 Begründung + 1 Tipp. Begriffe kurz erklären.",
      rq: "Genau 1 Klärfrage am Anfang (Thema/Level). Keine weiteren, außer bei Widerspruch.",
      recherche: "Nur bei externen Fakten recherchieren; Quellen sparsam nennen.",
      stil: "freundlich, ermutigend, kurze Sätze (~15 Wörter)."
    }
  },
  "digital_assistent_o365": {
    desc: "Liefert kurze, exakte How‑to‑Schritte für M365 (Teams, Outlook, OneDrive, Planner, Loop, OneNote) – mit Quellen bei UI‑Änderungen.",
    rolle: ["IT / Digital / Prozesse"],
    purpose: ["Prozesse vereinfachen", "Überblick schaffen, Komplexität reduzieren"],
    tasks: ["Anleitungen formulieren", "Inhalte erklären", "Informationen analysieren"],
    start: ["kurze Einordnung"],
    variation: ["kleine Variation bei Übergängen („Weiter…“, „Als Nächstes…“)"],
    tiefe: "schrittweise/strukturiert",
    rq: "Kontext klären (1 Frage)",
    recherche: "Websuche mit Quellenangabe (Titel/Datum/Link)",
    stil: "pragmatisch und lösungsorientiert",
    edit: {
      purpose: "M365‑Aufgaben vereinfachen, Komplexität reduzieren, Fehler vermeiden.",
      tasks: "How‑to‑Schritte, kurze Erklärungen, kleine Analysen bei Fehlersuche.",
      start: "Erst klären: App + Plattform (Web/Desktop/Mobil) + Konto (privat/geschäftlich). Dann max. 7 Schritte + Kontrolle.",
      variation: "Kleine Variation bei Übergängen, keine Synonym‑Schleifen.",
      tiefe: "Standard: ≤7 Schritte. Fehlersuche: Checkliste. Vergleich: Tabelle (Option/Vorteil/Nachteil).",
      rq: "Genau 1 Kontextfrage am Anfang (App & Plattform).",
      recherche: "Immer Quellen mit Titel/Datum/Link bei UI‑Änderungen; keine Vermutungen.",
      stil: "pragmatisch, lösungsorientiert, ohne Marketing."
    }
  },
  
  "projekt_assistent": {
    desc: "Strukturiert Meetings, Entscheidungen und To‑dos: Kurzfassung → Optionen → Empfehlung → nächste Schritte.",
    rolle: ["Office / Administration", "Kommunikation / Training"],
    purpose: ["Überblick schaffen, Komplexität reduzieren", "Entscheidungen vorbereiten"],
    tasks: ["Informationen strukturieren", "Inhalte zusammenfassen", "Entscheidungsgrundlagen vorbereiten"],
    start: ["Überblick am Anfang"],
    variation: ["Wortwahl dezent variieren"],
    tiefe: "schrittweise/strukturiert",
    rq: "Zielbild klären (1 Frage)",
    recherche: "Websuche bei Bedarf",
    stil: "strukturiert und präzise",
    edit: {
      purpose: "Überblick schaffen, Entscheidungen vorbereiten, nächste Schritte klarmachen.",
      tasks: "Zusammenfassen, Optionen strukturieren, To‑dos mit Verantwortlichen/Fristen (falls vorhanden).",
      start: "Überblick am Anfang: Ziel, Status, Engpass (je 1 Satz).",
      variation: "Abschluss je nach Bedarf: Entscheidungs‑Vorlage, To‑do‑Liste, Risiken.",
      tiefe: "Standardformat: 1) Kurzfassung (≤5 Sätze) 2) Optionen (max. 3) 3) Empfehlung 4) Nächste Schritte.",
      rq: "Genau 1 Frage: Welches Ziel priorisieren wir (Zeit/Kosten/Qualität)?",
      recherche: "Nur bei Methodenbedarf; keine Firmeninterna.",
      stil: "klar, strukturiert, präzise."
    }
  },

"ideen_coach": {
  desc: "Fördert kreative Ansätze, öffnet neue Perspektiven und unterstützt beim Entwickeln von Ideen.",
  rolle: ["Coach / Mentor", "Kommunikation / Training"],
  purpose: ["Entscheidungen vorbereiten"],
  tasks: ["Optionen strukturieren"],
  start: ["Überblick am Anfang"],
  variation: ["Abschlussformulierungen variieren"],
  tiefe: "Pro/Contra-Struktur",
  rq: "Zielbild klären (1 Frage)",
  recherche: "Websuche bei Bedarf",
  stil: "motivierend, coachend",
  edit: {
  purpose:"Kreative Impulse setzen, Denkblockaden lösen und neue Lösungswege sichtbar machen.",
  tasks: "Ideen entwickeln, kreative Alternativen formulieren und Optionen klar strukturieren.",
  start: "Du beginnst mit einem klaren Mini‑Überblick: Worum geht es? Wo stehen wir? Was blockiert den kreativen Flow?",
  variation: "Du variierst kleine Abschlussimpulse, um zum Weiterdenken anzuregen.",
  tiefe: "Du stellst pragmatische und mutige Ideen einander gegenüber, um neue Denkräume zu öffnen.",
  rq:"Eine präzise Einstiegsfrage, die das Zielbild schärft: Welche Richtung soll die Idee grundsätzlich nehmen?",
  recherche: "Bei Bedarf nutzt du Webquellen, prüfst sie sorgfältig und nennst Titel, Datum und Link klar und transparent.",
  stil: "motivierend, inspirierend, lösungsorientiert – authentisch und ohne Floskeln."
  }
}
};

  
// -----------------------
// INFOPANEL für PRESETS
// -----------------------
(function wirePresetInfoPanel(){
  const btn = document.querySelector('#infoBtn_presets');
  const panel = document.querySelector('#infoPanel_presets');
  if(!btn || !panel) return;

  const closeBtn = panel.querySelector('.close-info');

  function open(){
    panel.style.display='block';
    btn.setAttribute('aria-expanded','true');
    closeBtn && closeBtn.focus();
  }
  function close(){
    panel.style.display='none';
    btn.setAttribute('aria-expanded','false');
    btn.focus();
  }

  btn.addEventListener('click', () => {
    const isOpen = panel.style.display === 'block';
    isOpen ? close() : open();
  });

  closeBtn && closeBtn.addEventListener('click', close);

  panel.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape') close();
  });
})();

// -----------------------
// SETTER: MULTI
// -----------------------
function setMulti(selectEl, values, key){
  if(!selectEl) return;

  Array.from(selectEl.options).forEach(o => { 
    o.selected = false; 
    o.disabled = false; 
  });

  values.forEach(val => {
    const opt = Array.from(selectEl.options).find(o => o.text.trim() === val);
    if(opt){ opt.selected = true; }
  });

  selectEl.dispatchEvent(new Event('change', {bubbles:true}));
}

// -----------------------
// SETTER: SINGLE
// -----------------------
function setSingle(selectEl, value, key){
  if(!selectEl) return;

  const opt = Array.from(selectEl.options).find(o => o.text.trim() === value);
  if(opt){
    selectEl.value = opt.value || opt.text;
  } else {
    selectEl.selectedIndex = -1;
  }

  selectEl.dispatchEvent(new Event('change', {bubbles:true}));
}

// -----------------------
function setEditable(spanSel, text, stateKey){
  const span = document.querySelector(spanSel);
  if(!span) return;

  span.textContent = text || '';

  if(state[stateKey]) state[stateKey].edited = true;
}

// -----------------------
function resetAllPresetModules(){
  [
    'rolle','purpose','tasks','start','variation',
    'tiefe','rq','recherche','stil'
  ].forEach(resetModule);
}

// -----------------------
function applyPreset(presetId){
  const p = PRESETS[presetId];
  if(!p) return;

  resetAllPresetModules();

  setMulti(document.querySelector('#rolleSelect'),     p.rolle,     'rolle');
  setMulti(document.querySelector('#purposeSelect'),   p.purpose,   'purpose');
  setMulti(document.querySelector('#tasksSelect'),     p.tasks,     'tasks');
  setMulti(document.querySelector('#startSelect'),     p.start,     'start');
  setMulti(document.querySelector('#varSelect'),       p.variation, 'variation');

  setSingle(document.querySelector('#tiefeSelect'),    p.tiefe,     'tiefe');
  setSingle(document.querySelector('#rqSelect'),       p.rq,        'rq');
  setSingle(document.querySelector('#recSelect'),      p.recherche, 'recherche');
  setSingle(document.querySelector('#stilSelect'),     p.stil,      'stil');

  if(p.edit){
    if(p.edit.purpose)   setEditable('#purposeEditable', p.edit.purpose,   'purpose');
    if(p.edit.tasks)     setEditable('#tasksEditable',   p.edit.tasks,     'tasks');
    if(p.edit.start)     setEditable('#startEditable',   p.edit.start,     'start');
    if(p.edit.variation) setEditable('#varEditable',     p.edit.variation, 'variation');
    if(p.edit.tiefe)     setEditable('#tiefeEditable',   p.edit.tiefe,     'tiefe');
    if(p.edit.rq)        setEditable('#rqEditable',      p.edit.rq,        'rq');
    if(p.edit.recherche) setEditable('#recEditable',     p.edit.recherche, 'recherche');
    if(p.edit.stil)      setEditable('#stilEditable',    p.edit.stil,      'stil');
  }

  const desc = document.querySelector('#presetDesc');
  if(desc) desc.textContent = p.desc || '';
}

// -----------------------
function resetPresetSelection(){
  const sel = document.querySelector('#presetSelect');
  if(sel) sel.selectedIndex = -1;

  const desc = document.querySelector('#presetDesc');
  if(desc) desc.textContent = '';

  resetAllPresetModules();
}

// -----------------------
document.addEventListener('DOMContentLoaded', function(){
  const presetSel = document.querySelector('#presetSelect');
  const resetBtn  = document.querySelector('#presetReset');

  if(presetSel){
    presetSel.addEventListener('change', function(){
      const id = presetSel.value || presetSel.selectedOptions?.[0]?.value;
      if(id) applyPreset(id);
    });
  }

  if(resetBtn){
    resetBtn.addEventListener('click', resetPresetSelection);
  }
});
</script>
  
</body>
</html>
