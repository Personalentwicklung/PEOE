<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baukasten für Copilot-Chat-Agenten</title>
  <style>
    :root{
      /* Farben – angelehnt an PEOE-Seiten */
      --primary:#005A9C;
      --primary-600:#0a66a8;
      --accent:#2FB1C5;
      --bg:#f5f7fa;
      --card-bg:#ffffff;
      --subtle:#eef2f5;
      --muted:#4a5568;
      --text:#1a202c;
      --border:#e2e8f0;
      --shadow:0 4px 14px rgba(0,0,0,0.08);
      --radius:10px;
      --warning:#C05621;
      --success:#2F855A;
      --focus:#2FB1C5;
      /* Hellgrün für editierbare Felder */
      --edit-bg:#E8F5E9;
      --edit-border:#81C784;
      --edit-focus:#43A047;
      /* Grau für nicht-editierbare Badge (Rolle) */
      --badge-bg:#E5E7EB;
      --badge-border:#D1D5DB;
      /* Maße */
      --container:1024px;
      --space-1:8px;
      --space-2:12px;
      --space-3:16px;
      --space-4:20px;
      --space-5:28px;
      --space-6:36px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .container{max-width:var(--container);margin:0 auto;padding:24px;}
    h1{font-size:28px;margin:0 0 var(--space-4);color:var(--primary);text-align:center}
    h2{font-size:22px;margin:0 0 var(--space-3);color:var(--primary)}
    h3{font-size:18px;margin:0 0 var(--space-2);color:var(--primary)}
    p{margin:0 0 var(--space-3);color:var(--text)}
    .card{
      background:var(--card-bg);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--space-5);
      margin:0 0 var(--space-5);
    }
    .subcard{
      background:var(--subtle);
      border:1px solid var(--border);
      border-radius:8px;
      padding:16px;
      margin:var(--space-3) 0;
    }
    .btn{
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:12px 20px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    .btn:hover{background:var(--primary-600)}
    .btn:focus{outline:3px solid var(--focus);outline-offset:2px}
    .btn--sm{padding:8px 14px;font-size:14px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:20px;flex-wrap:wrap;align-items:flex-start}
    .grow{flex:1 1 320px}
    /* Sub-Hinweise: Frage fett, Auswahlhinweis normal */
    .subhint{font-size:14px;color:var(--muted);margin:0 0 6px;}
    .subhint--question{font-weight:600;color:var(--text);} /* fett wie Label */
    .subhint--choose{font-weight:400;} /* nicht fett */
    /* Selects */
    select{
      width:100%;
      min-width:280px;
      max-width:100%;
      padding:6px;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff;
      color:var(--text);
      font-size:14px;
      line-height:1.4;
    }
    select option{font-size:14px;}
    .meta{
      display:flex;align-items:center;gap:12px;
      margin-top:8px;color:var(--muted);font-size:14px;
    }
    .hint{color:var(--warning);font-size:14px;margin-top:6px}
    .preview{
      margin-top:12px;
      padding:10px 12px;
      border:1px dashed var(--border);
      border-radius:8px;
      background:#fcfcfd;
    }
    .editable{
      display:inline-block;
      min-width:160px;
      min-height:1.4em;
      background:var(--edit-bg);
      border:1px dashed var(--edit-border);
      border-radius:6px;
      padding:2px 6px;
      line-height:1.6;
    }
    .demo-editable{
      display:inline-block;
      background:var(--edit-bg);
      border:1px dashed var(--edit-border);
      border-radius:6px;
      padding:2px 6px;
      line-height:1.6;
      font-size:14px;
      cursor:default;
      user-select:none;
    }
    .editable:focus{outline:2px solid var(--edit-focus);background:#E3F2E5}
    .badge-gray{
      display:inline-block;
      min-width:160px;
      min-height:1.4em;
      background:var(--badge-bg);
      border:1px solid var(--badge-border);
      border-radius:6px;
      padding:2px 6px;
      line-height:1.6;
    }
    .copy-area .title-line{font-weight:700;margin-bottom:8px}
    .copy-msg{margin-top:10px;color:var(--success);display:none}
    /* Startscreen / Umschaltung */
    #builder{display:none}
    .centered{display:flex;min-height:100vh;align-items:center;justify-content:center}
    .start-card{max-width:760px}
    /* Hinweisbox */
    .top-note{
      margin-bottom:var(--space-4);
      padding:12px 14px;
      border-left:4px solid var(--accent);
      background:#f3fafc;
      border-radius:6px;
    }
    .actions-line{
      display:flex;justify-content:flex-end;gap:10px;margin-top:14px;flex-wrap:wrap;
    }
    .info-btn{
      background:#ffffff;color:var(--accent);border:1.5px solid var(--accent);border-radius:999px;padding:10px 16px;font-weight:600;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.06);
    }
    .info-btn:hover{background:#f7fafc}
    .info-btn:focus{outline:3px solid var(--focus);outline-offset:2px}

    /* === Info-Modal (Optionale Info-Ebene) === */
    @keyframes soft-pulse {
      0% { box-shadow: 0 0 0 0 rgba(47, 177, 197, 0.40); }
      70% { box-shadow: 0 0 0 10px rgba(47, 177, 197, 0.00); }
      100% { box-shadow: 0 0 0 0 rgba(47, 177, 197, 0.00); }
    }
    .info-pulse { animation: soft-pulse 3s infinite; }
    #infoModal {
      display: none; position: fixed; inset: 0; z-index: 10000;
      background: rgba(0,0,0,0.65); backdrop-filter: blur(4px);
      align-items: center; justify-content: center; padding: 24px;
    }
    .modal-content {
      background: var(--card-bg); padding: 40px; border-radius: var(--radius);
      max-width: 640px; width: 100%; position: relative; box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .close-x { position: absolute; top: 10px; right: 14px; font-size: 32px; cursor: pointer; color: var(--muted); line-height: 1; }
    .info-step { display: none; text-align: left; }
    .info-step.active { display: block; }
    .info-step ul { margin: 0; padding-left: 18px; }
    .step-nav { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-top: 24px; border-top: 1px solid var(--border); padding-top: 16px; }
    /* === End Info-Modal === */

    @media (max-width: 720px){.container{padding:16px;}h1{font-size:24px}}
  </style>
</head>
<body>
  <!-- START: Startscreen -->
  <section id="start" class="centered">
    <div class="card start-card">
      <div class="container">
        <h1>Baukasten für Copilot-Chat-Agenten</h1>
        <p>Dieser Baukasten unterstützt dich dabei, einen vollständig einsatzbereiten Copilot Chat Agenten zu erstellen. Du wählst die gewünschten Eigenschaften aus, passt die erzeugten Textbausteine bei Bedarf an und kopierst anschließend das fertige Agenten Script in einen neuen Agent in Copilot.</p>
        <p>Viel Erfolg beim Erstellen deines Agents.</p>
        <div class="top-note" role="note" aria-label="Datenschutzhinweis">
          <h3>Datenschutzhinweis</h3>
          <p>Der Baukasten speichert keine persönlichen Daten. Alle Eingaben bleiben ausschließlich in deinem Browser und werden nicht an Server übertragen. Beim Schließen der Seite gehen nicht gespeicherte Inhalte verloren.</p>
        </div>

        <!-- Button-Gruppe: Start (links) / Info (rechts) -->
        <div id="startButtons" style="display:flex; justify-content:space-between; align-items:center; gap:16px; margin-top:25px; width:100%">
          <button id="startBtn" class="btn">Baukasten starten</button>
          <button id="mainInfoBtn" class="info-btn info-pulse" type="button" aria-haspopup="dialog" aria-controls="infoModal">Info zum Baukasten</button>
        </div>
      </div>
    </div>
  </section>
  <!-- END: Startscreen -->

  <!-- START: Builder -->
  <section id="builder">
    <div class="container">
      <h1>Baukasten für Copilot-Chat-Agenten</h1>

      <div class="card">
        <h3>Hinweise zur Bedienung</h3>
        <p class="muted"></p>
        <p>Dieser Baukasten ist in logische Module unterteilt, die das Fundament für deinen Chat-Agenten bilden.</p>
        <p>In allen Modulen außer dem ersten kannst du die Texte in den <span class="demo-editable"><strong>grünen Feldern</strong></span> nach Bedarf ändern.</p>
        <p>Bitte achte darauf, dass die <strong>inhaltliche Richtung</strong> und die <strong>maximale Auswahl</strong> erhalten bleibt.</p>
        <p>Sobald dein Entwurf steht, lässt sich das Script mit einem Klick in die Zwischenablage kopieren. Unbearbeitete Module fließen nicht in das Agenten-Script ein.</p>
        <p>Starte jetzt mit der Auswahl und nutze bei Unklarheiten die Hinweisbutton.</p>
        <p><strong>Viel Erfolg beim Erstellen!</strong></p>
      </div>

      <!-- ... [DER REST DEINER MODULE UNVERÄNDERT – aus deiner Datei] ... -->

      <!-- MODUL: Rolle / Persona (unverändert) -->
      <div class="card" id="mod-rolle">
        <h2>Rolle / Persona</h2>
        <div class="subcard">
          <h3 style="margin-top:0">Zuständigkeit</h3>
          <div class="subhint subhint--question">Wofür soll der Agent zuständig sein?</div>
          <div class="subhint subhint--choose">Wähle bis zu 3 Rollen:</div>
          <select id="rolleSelect" multiple size="8" aria-describedby="rolleCount rolleHint" aria-label="Rollen auswählen">
<option>Ausbildungsunterstützung, Azubi</option>
<option>Coach / Mentor</option>
<option>Einkauf / Verkauf, CSC</option>
<option>Engineering</option>
<option>Fachkraft Chemieproduktion</option>
<option>Fachkraft Technik</option>
<option>Fachkraft Wartung / Instandhaltung</option>
<option>Finance</option>
<option>Führungskraft</option>
<option>Gesundheit / Ernährung</option>
<option>HSE / Arbeitssicherheit</option>
<option>IT / Digital / Prozesse</option>
<option>Kommunikation / Training</option>
<option>Labor / QA</option>
<option>Office / Administration</option>
<option>Prozess- & Verfahrensingenieur</option>
<option>Recht / Steuern</option>
<option>Support & Lernen</option>
<option>Support & Service</option>
<option>Verwaltung, HR</option>
          </select>
          <div class="meta">
            <span id="rolleCount" aria-live="polite">0 / 3</span>
            <span class="hint" id="rolleHint" hidden>Maximale Anzahl erreicht.</span>
          </div>
          <div class="preview">
            <p>Dein Wirkungsbereich ist <span id="rolleBadge" class="badge-gray"></span>. Du agierst als professioneller, menschlicher Begleiter für diesen Kontext.</p>
          </div>
          <div class="actions-line">
            <button type="button" class="info-btn" id="infoBtn_rolle" aria-controls="infoPanel_rolle" aria-expanded="false">ℹ️ Hinweise</button>
            <button type="button" class="btn btn--sm" id="rolleReset">Zurücksetzen (Rolle/Persona)</button>
          </div>
          <div class="info-panel" id="infoPanel_rolle" role="region" aria-label="Hinweise zu Rolle / Persona" style="display:none">
            <h4>Hinweise zu Rollen / Persona</h4>
            <p><strong>Wofür?</strong> Festlegt den fachlichen Kontext (z. B. Ausbildung, HSE) – Beispiele, Ton und Prioritäten richten sich daran aus.</p>
            <p><strong>Keine Befugnisse:</strong> Nutze Kontext- statt Entscheidungsrollen.</p>
            <p><strong>Best Practice:</strong> 1–3 präzise Rollen wählen.</p>
            <button type="button" class="close-info">Verbergen</button>
          </div>
        </div>
      </div>

      <!-- [.. hier folgen Purpose / Tasks / Stil / Grundverhalten etc. – unverändert aus deiner Datei ..] -->

      <!-- COPY -->
      <div class="card copy-area" id="copyArea">
        <div class="title-line">Kopiere nun das Agenten-Script in die Zwischenablage!</div>
        <button class="btn" id="copyBtn">Kopieren in Zwischenablage</button>
        <div class="copy-msg" id="copyMsg">Das Agent‑Skript wurde in die Zwischenablage kopiert!</div>
      </div>

      <!-- Anleitung -->
      <div class="card">
        <h2>Wie geht`s weiter? .... Kurze Anleitung</h2>
        <ol class="guide">
          <li><strong>Script Kopieren</strong><br/>Kopiere das Agenten-Script in dem Du auf den Button "Kopieren in Zwischenablage" klickst.</li>
          <li><strong>Neuen Agenten anlegen</strong><br/>Öffne in Copilot Chat den Punkt „Neuer Agent“. Dieser befindet sich in der linken Navigation.</li>
          <li><strong>Bezeichnung eintragen</strong><br/>Gib deinem Agenten einen kurzen, eindeutigen Namen. Beispiele: Office‑Assistent, Begleiter, Coach, Azubi‑Tutor.</li>
          <li><strong>Beschreibung eintragen</strong><br/>Beschreibe in ein bis zwei Sätzen, wofür der Agent gedacht ist.<br/>Beispiel: „Unterstützt bei täglichen Aufgaben, erklärt Inhalte verständlich und liefert klare, zuverlässige Antworten.“</li>
          <li><strong>Agent‑Script einfügen</strong><br/>Füge den aus dem Baukasten kopierten Text in das Feld <strong>„Anweisungen“</strong> ein.</li>
          <li><strong>Agent speichern</strong><br/>Klicke oben rechts auf <strong>„Erstellen“</strong>, um den Agenten anzulegen und verfügbar zu machen.</li>
          <li><strong>Agent testen</strong><br/>Teste den Agent mit typischen Fragen aus deinem Arbeitsalltag und lasse den Baukasten währenddessen geöffnet!</li>
          <li><strong>Agent anpassen</strong><br/>Du kannst den Agent jederzeit weiter verfeinern. Änderungen im Baukasten → Script erneut kopieren → in Copilot einfügen.</li>
        </ol>
      </div>
    </div>
  </section>
  <!-- END: Builder -->

  <!-- Info-Modal: Optionale Info-Ebene -->
<div id="infoModal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <span id="closeInfo" class="close-x" role="button" aria-label="Schließen">&times;</span>

    <!-- SCREEN 1 -->
    <div class="info-step active" data-step="1">
      <h3>Was macht dieser Baukasten?</h3>
      <p>Dieser Baukasten erstellt Copilot‑Agenten, die verlässlich, klar und strukturiert arbeiten.</p>

      <p>Mit wenigen Auswahlfeldern bestimmst du:</p>
      <ul>
        <li>wie ein Agent antwortet</li>
        <li>wie er kommuniziert</li>
        <li>wie er mit Rückfragen, Recherche und Unklarheiten umgeht</li>
        <li>wie er seine Aufgaben strukturiert</li>
      </ul>

      <p>Der Fokus liegt auf Verhalten, Ton und Arbeitsweise.</p>
      <p>Die fachlichen Fähigkeiten bringt Copilot bereits vollständig mit.</p>
      <p>Der Baukasten sorgt dafür, dass sie gezielt, nachvollziehbar und konsistent eingesetzt werden.</p>
    </div>

    <!-- SCREEN 2 -->
    <div class="info-step" data-step="2">
      <h3>Wie funktioniert das?</h3>

      <p>Du stellst dir einen Agenten zusammen, indem du fünf Bereiche auswählst:</p>

      <p><strong>Rolle / Persona</strong><br>Welcher Grundstil? (z. B. sachlich, unterstützend, technisch)</p>

      <p><strong>Purpose (Ziel)</strong><br>Was soll der Agent grundsätzlich erreichen?<br>(z. B. Prozesse vereinfachen, Aufgaben beschleunigen)</p>

      <p><strong>Tasks (Arbeitsauftrag)</strong><br>Was macht der Agent typischerweise?<br>(z. B. analysieren, strukturieren, erklären)</p>

      <p><strong>Kommunikationsstil</strong><br>Wie klingt der Agent?<br>(z. B. ruhig & klar, analytisch, kompakt)</p>

      <p><strong>Grundverhalten</strong><br>Wie arbeitet der Agent?</p>
      <ul>
        <li>Wie er startet</li>
        <li>Wie tief er antwortet</li>
        <li>Wann er Rückfragen stellt</li>
        <li>Wie er recherchiert</li>
        <li>Wie natürlich er formuliert</li>
      </ul>

      <p>Durch diese Einstellungen entsteht ein klar definiertes Regelwerk, das den Agenten stabil, klar und vorhersehbar macht.</p>
    </div>

    <!-- SCREEN 3 -->
    <div class="info-step" data-step="3">
      <h3>Was passiert im Hintergrund?</h3>

      <p>Der Baukasten setzt alle Entscheidungen in ein strukturiertes Regelwerk um. Dieses Regelwerk steuert:</p>
      <ul>
        <li>Tonfall</li>
        <li>Struktur</li>
        <li>Antwort-Niveau</li>
        <li>Rückfragenverhalten</li>
        <li>Recherche‑Verhalten</li>
        <li>Variationen im Ausdruck</li>
        <li>Umgang mit unklaren Situationen</li>
        <li>Grenzen (keine Diagnosen, keine Rechtsauskünfte usw.)</li>
        <li>Transparenz, Konsistenz</li>
        <li>Datenschutz‑Hinweise</li>
      </ul>

      <p>Das erzeugte Script ist klar, konsistent und universell – und genau das macht die Agenten verlässlich.</p>
      <p>Zusätzlich werden feste Bestandteile in das Script eingebaut. So z. B. Eskalationsstufen und DSGVO.</p>
    </div>

    <!-- SCREEN 4 -->
    <div class="info-step" data-step="4">
      <h3>Wie setzt der Agent deine Einstellungen um?</h3>

      <p>Die Auswahl im Baukasten bildet die oberste Steuerlogik des Agenten. Diese Anweisungen haben Vorrang vor:</p>
      <ul>
        <li>benutzerdefinierten Copilot‑Einstellungen</li>
        <li>persönlichen Erinnerungen</li>
        <li>spontanen Stiländerungen</li>
        <li>dem Standard‑Verhalten der KI</li>
      </ul>

      <p>Der Agent folgt dadurch konsequent:</p>
      <ul>
        <li>dem gewählten Ton</li>
        <li>dem definierten Arbeitsverhalten</li>
        <li>der gewünschten Struktur</li>
        <li>der festgelegten Rückfragen‑ und Recherchelogik</li>
      </ul>

      <p>Gleichzeitig nutzt er alle Fähigkeiten, die Copilot bereits mitbringt, wendet sie aber innerhalb deiner definierten Regeln an – konsistent, kontrolliert und ohne Stilbrüche.</p>
    </div>

    <!-- NAVIGATION -->
    <div class="step-nav">
      <button id="prevStep" class="btn btn--sm" type="button">Zurück</button>
      <div id="stepDots" class="muted" aria-live="polite"></div>
      <button id="nextStep" class="btn btn--sm" type="button">Weiter</button>
    </div>
  </div>
</div>

  <script>
  // --- State
  const state = {
    rolle: { selected: [], limit: 3, edited:false },
    purpose: { selected: [], limit: 2, edited:false },
    tasks: { selected: [], limit: 3, edited:false },
    start: { selected: [], limit: 3, edited:false },
    variation: { selected: [], limit: 3, edited:false },
    tiefe: { selected: '', edited:false },
    rq: { selected: '', edited:false },
    recherche: { selected: '', edited:false },
    stil: { selected: '', edited:false }
  };
  // --- Helpers
  const qs = (sel, root=document) => root.querySelector(sel);
  const joinList = (arr) => arr.join(', ');
  const textOrEmpty = (selector) => (qs(selector)?.textContent || '').trim();
  function enableClickToggle(selectEl, key){
    selectEl.addEventListener('mousedown', (e) => {
      const opt = e.target;
      if(opt && opt.tagName === 'OPTION'){
        e.preventDefault();
        opt.selected = !opt.selected;
        selectEl.dispatchEvent(new Event('change', {bubbles:true}));
        selectEl.focus();
      }
    });
  }
  function enforceMultiLimit(selectEl, key){
    const { limit } = state[key];
    const current = Array.from(selectEl.options).filter(o=>o.selected).map(o=>o.text);
    const prev = state[key].selected.slice();
    const kept = prev.filter(x=>current.includes(x));
    const added = current.filter(x=>!prev.includes(x));
    const merged = kept.concat(added);
    if(merged.length > limit){
      const toDeselect = merged.slice(limit);
      Array.from(selectEl.options).forEach(o => { if(toDeselect.includes(o.text)) o.selected = false; });
      state[key].selected = merged.slice(0, limit);
    } else {
      state[key].selected = merged;
    }
    const idBase = key;
    const countEl = qs(`#${idBase}Count`);
    const hintEl = qs(`#${idBase}Hint`);
    if(countEl) countEl.textContent = `${state[key].selected.length} / ${limit}`;
    const atMax = state[key].selected.length >= limit;
    if(hintEl) hintEl.hidden = !atMax;
    Array.from(selectEl.options).forEach(o => { if(!o.selected) o.disabled = atMax; });
    updateEditableFromSelection(key);
  }
  function updateEditableFromSelection(key){
    if (key === 'rolle') { qs('#rolleBadge').textContent = joinList(state.rolle.selected); return; }
    const map = {
      purpose: { span: '#purposeEditable', value: joinList(state.purpose.selected) },
      tasks: { span: '#tasksEditable', value: joinList(state.tasks.selected) },
      start: { span: '#startEditable', value: joinList(state.start.selected) },
      variation: { span: '#varEditable', value: joinList(state.variation.selected) },
      tiefe: { span: '#tiefeEditable', value: state.tiefe.selected },
      rq: { span: '#rqEditable', value: state.rq.selected },
      recherche: { span: '#recEditable', value: state.recherche.selected },
      stil: { span: '#stilEditable', value: state.stil.selected }
    };
    const target = map[key];
    if (!target) return;
    const span = qs(target.span);
    const newVal = target.value ?? '';
    const curVal = (span.textContent || '').trim();
    if (!state[key]?.edited || curVal === '' || curVal === newVal) {
      span.textContent = newVal;
    }
  }
  function updateSingleSelect(selectEl, key){
    const val = selectEl.value || '';
    state[key].selected = val;
    if(state[key].edited) return;
    const spanId = ({ tiefe:'#tiefeEditable', rq:'#rqEditable', recherche:'#recEditable', stil:'#stilEditable' })[key];
    if(spanId) qs(spanId).textContent = val;
  }
  function resetModule(key){
    switch(key){
      case 'rolle':{
        const el = qs('#rolleSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
        state.rolle.selected = []; qs('#rolleCount').textContent = `0 / ${state.rolle.limit}`; qs('#rolleHint').hidden = true; qs('#rolleBadge').textContent = ''; break;
      }
      case 'purpose':{
        const el = qs('#purposeSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
        state.purpose.selected = []; state.purpose.edited=false; qs('#purposeCount').textContent=`0 / ${state.purpose.limit}`; qs('#purposeHint').hidden=true; qs('#purposeEditable').textContent=''; break;
      }
      case 'tasks':{
        const el = qs('#tasksSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
        state.tasks.selected=[]; state.tasks.edited=false; qs('#tasksCount').textContent=`0 / ${state.tasks.limit}`; qs('#tasksHint').hidden=true; qs('#tasksEditable').textContent=''; break;
      }
      case 'start':{
        const el = qs('#startSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
        state.start.selected=[]; state.start.edited=false; qs('#startEditable').textContent=''; qs('#startCount').textContent=`0 / ${state.start.limit}`; qs('#startHint').hidden=true; break;
      }
      case 'variation':{
        const el = qs('#varSelect'); Array.from(el.options).forEach(o=>{o.selected=false;o.disabled=false;});
        state.variation.selected=[]; state.variation.edited=false; qs('#varEditable').textContent=''; qs('#variationCount').textContent=`0 / ${state.variation.limit}`; qs('#variationHint').hidden=true; break;
      }
      case 'tiefe':{ qs('#tiefeSelect').selectedIndex=-1; state.tiefe.selected=''; state.tiefe.edited=false; qs('#tiefeEditable').textContent=''; break; }
      case 'rq':{ qs('#rqSelect').selectedIndex=-1; state.rq.selected=''; state.rq.edited=false; qs('#rqEditable').textContent=''; break; }
      case 'recherche':{ qs('#recSelect').selectedIndex=-1; state.recherche.selected=''; state.recherche.edited=false; qs('#recEditable').textContent=''; break; }
      case 'stil':{ qs('#stilSelect').selectedIndex=-1; state.stil.selected=''; state.stil.edited=false; qs('#stilEditable').textContent=''; break; }
    }
  }
  function getModuleTextFromEditableOrSelection(spanSelector, selected){
    const t = textOrEmpty(spanSelector);
    if(t) return t;
    if(Array.isArray(selected)) return selected.length ? joinList(selected) : '';
    return selected || '';
  }
  function buildScript(){
    const parts = [];
    if(state.rolle.selected.length){
      const rolle = joinList(state.rolle.selected);
      parts.push(`[Rolle / Persona]
Dein Wirkungsbereich ist ${rolle}. Du agierst als professioneller, menschlicher Begleiter für diesen Kontext.`);
    }
    const purpose = getModuleTextFromEditableOrSelection('#purposeEditable', state.purpose.selected);
    if(purpose){
      parts.push(`[Ziel / Purpose]
Dein übergeordneter Zweck ist es, ${purpose}. Du orientierst deine gesamte Arbeitsweise an diesem Ziel.`);
    }
    const tasks = getModuleTextFromEditableOrSelection('#tasksEditable', state.tasks.selected);
    if(tasks){
      parts.push(`[Auftrag / Task]
Dein Auftrag umfasst folgende Tätigkeiten: ${tasks}. Du führst diese Aufgaben verlässlich, klar strukturiert und nutzerorientiert aus.`);
    }
    const startSel = getModuleTextFromEditableOrSelection('#startEditable', state.start.selected);
    const variationSel = getModuleTextFromEditableOrSelection('#varEditable', state.variation.selected);
    const antwortstil = getModuleTextFromEditableOrSelection('#tiefeEditable', state.tiefe.selected);
    const rueckfragen = getModuleTextFromEditableOrSelection('#rqEditable', state.rq.selected);
    const rechercheSel = getModuleTextFromEditableOrSelection('#recEditable', state.recherche.selected);
    const g = [];
    if(startSel) g.push(`Für den Einstieg nutzt du ${startSel}, situativ und ohne wiederholende Muster.`);
    if(variationSel) g.push(`Du variierst deinen Ausdruck dezent durch ${variationSel}, damit Antworten natürlich und nicht repetitiv wirken.`);
    if(antwortstil) g.push(`Deine Antworten folgen dem Stil ${antwortstil}, damit Inhalte klar, nachvollziehbar und strukturiert bleiben.`);
    if(rueckfragen) g.push(`Deine Rückfragenlogik lautet: ${rueckfragen}.`);
    if(rechercheSel) g.push(`Dein Recherche- und Quellenverhalten ist: ${rechercheSel}.`);
    if(g.length){
      parts.push(`[Grundverhalten / Arbeitslogik]
Du arbeitest nach folgender festen Logik:
${g.join('\\n\\n')}`);
    }
    const stil = getModuleTextFromEditableOrSelection('#stilEditable', state.stil.selected);
    if(stil){
      parts.push(`[Kommunikationsstil]
Dein Kommunikationsstil ist: ${stil}. Du hältst diesen Stil in Tonfall, Struktur und Wortwahl konsistent ein.`);
    }
    const fixBlocks = [
`[Formatoption (situativ nachgelagert)]
Biete nach der ersten Antwort optional an, das Ergebnis in einem gewünschten Format darzustellen (z. B. Schritte, Varianten, Pro/Contra, Formulierungen). Frag nur bei erkennbarem Strukturbedarf; sonst entscheide situativ.`,
`[Compliance DSGVO]
Du hältst dich jederzeit an Datenschutz, Vertraulichkeit, Sicherheit und professionelle Grenzen. Nie Diagnosen erfragen; nur arbeitsrelevante Einschränkungen klären.`,
`[Grenzen]
Keine Diagnosen oder medizinischen Aussagen; keine psychologischen Interpretationen; keine Rechtsberatung. Keine Beratung zu Kindern, Familie oder privaten Ursachen.
Bei privaten Belastungen: freundlich bleiben, Rolle klären, beruflichen Rahmen sortieren (Prioritäten, Ruhe, Arbeitsfähigkeit).
Bei gesundheitlichen Belastungen, auffälligen Fehlzeiten, eskalierten Konflikten oder Themen außerhalb deiner Rolle: Hinweise geben, dass HR/BGM/Betriebsrat eingebunden werden sollte. Immer sachlich, respektvoll, neutral, ohne persönliche Abwertungen.`,
`[Out-of-Scope]
Du kommunizierst klar, wenn eine Anfrage außerhalb des Zuständigkeitsbereiches liegt, und bietest dann sichere, fachlich passende Alternativen an.`,
`[Universelle Fehler- & Klarheitslogik]
Wenn Informationen fehlen, unklar oder widersprüchlich sind, frage einmal präzise nach, triff keine Annahmen und arbeite nicht mit Vermutungen. Bleibe faktentreu, biete bei Bedarf Optionen an und mach transparent, wenn du ohne Klärung nicht sinnvoll weitermachen kannst.`,
`[Konsistenz- & Lückenmanagement]
Prüfe Nutzerangaben auf Konsistenz, vermeide Endlos-Schleifen (max. eine Nachfrage) und halte Grenzen klar fest: Sag offen, wenn dir verlässliche Infos fehlen oder der Auftrag außerhalb deines Handlungsspielraums liegt.`,
`[Kommunikatives Eskalationsmodell]
Arbeite in vier Schritten:
(1) kurze offene Klärung,
(2) Konkretisierung mit Fokus,
(3) Konsequenz nach zwei unklaren Antworten („Ich kann ohne Klärung nicht weiterhelfen.“),
(4) Hinweis, dass das Thema ggf. einer formalen Prüfung durch zuständige Stellen bedarf.`,
`[Transparenzpflicht]
Sag früh und klar, welche Information du brauchst, um eine qualifizierte Antwort zu geben.`,
`[Werte & Unternehmensbezug]
Werte: Sicherheit, Qualität, respektvolles Verhalten, Herausforderung, Gewinnen. Werte nur nennen, wenn sie Orientierung geben („…damit wir Qualität/Sicherheit sichern.“). Trade-offs benennen; Sicherheit und Respekt priorisieren. Orientierung: mutig, klar, lösungsorientiert, ohne Drama.`
    ];
    parts.push(...fixBlocks);
    return parts.join('\\n\\n').trim();
  }
  function wireInfoPanel(key){
    const btn = qs(`#infoBtn_${key}`);
    const panel = qs(`#infoPanel_${key}`);
    if(!btn || !panel) return;
    const closeBtn = panel.querySelector('.close-info');
    function open(){ panel.style.display='block'; btn.setAttribute('aria-expanded','true'); closeBtn && closeBtn.focus(); }
    function close(){ panel.style.display='none'; btn.setAttribute('aria-expanded','false'); btn.focus(); }
    btn.addEventListener('click', ()=>{ const openNow = panel.style.display==='block'; openNow?close():open(); });
    closeBtn && closeBtn.addEventListener('click', close);
    panel.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
  }
  async function copyToClipboard(text){
    try{
      if(navigator.clipboard && window.isSecureContext){ await navigator.clipboard.writeText(text); }
      else { const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.focus(); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }
      return true;
    }catch(e){ console.error(e); return false; }
  }
  window.addEventListener('DOMContentLoaded', ()=>{
    // Start -> Builder
    qs('#startBtn').addEventListener('click', ()=>{
      qs('#start').style.display='none';
      qs('#builder').style.display='block';
      qs('#rolleSelect').focus();
    });
    // Info-Panels
    ['rolle','purpose','tasks','start','variation','tiefe','rq','recherche','stil'].forEach(wireInfoPanel);
    // Multi-Selects
    [
      {sel:'#rolleSelect', key:'rolle'},
      {sel:'#purposeSelect', key:'purpose'},
      {sel:'#tasksSelect', key:'tasks'},
      {sel:'#startSelect', key:'start'},
      {sel:'#varSelect', key:'variation'}
    ].forEach(d=>{
      const el = qs(d.sel);
      if(!el) return;
      enableClickToggle(el, d.key);
      el.addEventListener('change', e=>enforceMultiLimit(e.target, d.key));
    });
    // Single-Selects
    qs('#tiefeSelect')?.addEventListener('change', e=>updateSingleSelect(e.target, 'tiefe'));
    qs('#rqSelect')?.addEventListener('change', e=>updateSingleSelect(e.target, 'rq'));
    qs('#recSelect')?.addEventListener('change', e=>updateSingleSelect(e.target, 'recherche'));
    qs('#stilSelect')?.addEventListener('change', e=>updateSingleSelect(e.target, 'stil'));
    // Editable-Flags
    qs('#purposeEditable')?.addEventListener('input', ()=> state.purpose.edited = true);
    qs('#tasksEditable')?.addEventListener('input', ()=> state.tasks.edited = true);
    qs('#startEditable')?.addEventListener('input', ()=> {
      const joined = joinList(state.start.selected);
      state.start.edited = ((qs('#startEditable').textContent || '').trim() !== joined);
    });
    qs('#varEditable')?.addEventListener('input', ()=> {
      const joined = joinList(state.variation.selected);
      state.variation.edited = ((qs('#varEditable').textContent || '').trim() !== joined);
    });
    qs('#tiefeEditable')?.addEventListener('input', ()=> state.tiefe.edited = true);
    qs('#rqEditable')?.addEventListener('input', ()=> state.rq.edited = true);
    qs('#recEditable')?.addEventListener('input', ()=> state.recherche.edited = true);
    qs('#stilEditable')?.addEventListener('input', ()=> state.stil.edited = true);
    // Resets
    qs('#rolleReset')?.addEventListener('click', ()=>resetModule('rolle'));
    qs('#purposeReset')?.addEventListener('click', ()=>resetModule('purpose'));
    qs('#tasksReset')?.addEventListener('click', ()=>resetModule('tasks'));
    qs('#startReset')?.addEventListener('click', ()=>resetModule('start'));
    qs('#varReset')?.addEventListener('click', ()=>resetModule('variation'));
    qs('#tiefeReset')?.addEventListener('click', ()=>resetModule('tiefe'));
    qs('#rqReset')?.addEventListener('click', ()=>resetModule('rq'));
    qs('#recReset')?.addEventListener('click', ()=>resetModule('recherche'));
    qs('#stilReset')?.addEventListener('click', ()=>resetModule('stil'));
    // Copy
    qs('#copyBtn')?.addEventListener('click', async ()=>{
      const script = buildScript();
      const ok = await copyToClipboard(script);
      const msg = qs('#copyMsg');
      msg.style.display = ok ? 'block' : 'none';
      if(!ok) alert('Kopieren nicht möglich. Bitte manuell kopieren.');
      if(ok) setTimeout(()=> msg.style.display='none', 4000);
    });
  });

  // === Info-Modal Logic (DOMContentLoaded, isolated) ===
  document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('infoModal');
    var openBtn = document.getElementById('mainInfoBtn');
    var closeX = document.getElementById('closeInfo');
    var steps = modal ? modal.querySelectorAll('.info-step') : [];
    var nextBtn = document.getElementById('nextStep');
    var prevBtn = document.getElementById('prevStep');
    var stepDots = document.getElementById('stepDots');
    var current = 0;

    function update() {
      steps.forEach(function(s, i){ s.classList.toggle('active', i === current); });
      if (prevBtn) prevBtn.style.visibility = current === 0 ? 'hidden' : 'visible';
      if (nextBtn) nextBtn.textContent = current === steps.length - 1 ? 'Verstanden' : 'Weiter';
      if (stepDots) stepDots.textContent = Array.from({length: steps.length}, function(_, i){ return i === current ? '●' : '○'; }).join(' ');
    }

    if (openBtn) openBtn.addEventListener('click', function(){ if(!modal) return; modal.style.display='flex'; current = 0; update(); });
    if (closeX) closeX.addEventListener('click', function(){ if(!modal) return; modal.style.display='none'; });
    if (nextBtn) nextBtn.addEventListener('click', function(){ if (current < steps.length - 1) { current++; update(); } else if (modal) { modal.style.display='none'; } });
    if (prevBtn) prevBtn.addEventListener('click', function(){ if (current > 0) { current--; update(); } });
    if (modal) modal.addEventListener('click', function(e){ if (e.target === modal) modal.style.display='none'; });
  });
  // === End Info-Modal Logic ===
  </script>
</body>
</html>
